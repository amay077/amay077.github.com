<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RxProperty でイケてる入力フォームをもっとスッキリ実装する</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>RxProperty でイケてる入力フォームをもっとスッキリ実装する</h1>

<p>また来てしまいました...。こんにちわ、 RxProperty エヴァンジェリズムアドボケイトの @amay077 です。</p>
<!--more-->
<ul>
<li><a href="https://developers.eure.jp/tech/android_cool_form">RxJava,Kotlin,Databindingでイケてる入力フォームをスッキリ実装する / eureka tech blog</a></li>
</ul>
<p>興味深く読ませていただきました。</p>
<p>こちらの記事における <code>ViewProperties</code> の要点は次の箇所かと。</p>
<ol>
<li><code>ObservableField</code> を公開することにより Android DataBinding を活用する</li>
<li>RxJava の <code>BehaviorSubject.onNext</code> で View -&gt; ViewProperties への値の更新通知</li>
<li>RxJava のオペレータ(<code>map</code> や <code>combineLatest</code> など)を使うことで、 「入力項目が valid か？」 を通知する仕組みが簡単に作れる</li>
</ol>
<p>これらは、 <a href="https://github.com/k-kagurazaka/rx-property-android">RxProperty</a> を使うともっとスッキリと実装できます！</p>
<ol>
<li><a href="https://qiita.com/amay077/items/58e589780ccea6fd5470">先日も書いた</a> 通り、 RxProperty は <code>.value</code> で <strong><code>ObservableField</code> に変換できます</strong></li>
<li><code>RxProperty&lt;T&gt;</code> 自体は RxJava の <code>Observable&lt;T&gt;</code> からの派生であり、また最新の値を保持し設定もできます。 <code>subscribe</code> した時に保持されている値がすぐに notify されるかも選択できるので、 <strong>実質ほぼ <code>BehaviorSubject&lt;T&gt;</code> です</strong>。</li>
<li><code>RxProperty&lt;T&gt;</code> は、バリデータも内蔵しており、 <code>setValidator((T)-&gt;String?)</code> に <strong>「値 → エラー文字列への変換関数」 を渡してやるだけで validation ができます</strong>。</li>
<li>「実行された時の処理」と「それが実行できるか？」がセットになった <code>RxCommand</code> というクラスがあり、これをボタンにバインドしてやるだけで、<code>Button.enabled</code> と <code>Button.onClick</code> が連動します。</li>
</ol>
<h2 id="rxproperty-%E3%81%A7%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%81%9F">RxProperty で書いてみた <a class="direct-link" href="#rxproperty-%E3%81%A7%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%81%9F">#</a></h2>
<p>というわけで、元記事の <code>FormProperties</code> を、RxProperty を使って書いてみました。うずうずしてガマンできなかった :pray:  。</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> FormProperties <span class="token punctuation">{</span><br>    <span class="token keyword">enum</span> <span class="token keyword">class</span> <span class="token function">Gender</span><span class="token punctuation">(</span><span class="token keyword">val</span> id <span class="token operator">:</span>Int<span class="token punctuation">)</span> <span class="token punctuation">{</span> <br>        <span class="token function">MAN</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">WOMAN</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">OTHER</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">NOT_SET</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">val</span> disposables <span class="token operator">=</span> <span class="token function">CompositeDisposable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token comment">/** ニックネーム */</span><br>    <span class="token keyword">val</span> nickname <span class="token operator">=</span> RxProperty<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">setValidator</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">||</span> it<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><br>                    <span class="token comment">// エラーの場合はその説明を、エラーなしの場合は null を返却</span><br>                    <span class="token string">"ニックネームは2文字以上10文字以下にしてください"</span> <span class="token keyword">else</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><br><br>    <span class="token comment">/** 誕生日(Rawデータ) */</span><br>    <span class="token keyword">val</span> birthday <span class="token operator">=</span> RxProperty<span class="token operator">&lt;</span>Calendar<span class="token operator">></span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">setValidator</span> <span class="token punctuation">{</span><br>                <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">>=</span> Calendar<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span> <span class="token function">add</span><span class="token punctuation">(</span>Calendar<span class="token punctuation">.</span>YEAR<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">18</span> <span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token string">"18歳以上が必要です"</span> <span class="token keyword">else</span> <span class="token keyword">null</span><br>            <span class="token punctuation">}</span><br><br>    <span class="token comment">/** 誕生日(表示用文字列) */</span><br>    <span class="token keyword">val</span> birthdayText <span class="token operator">=</span> birthday<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span><br>        <span class="token function">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>JAPAN<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>time<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toReadOnlyRxProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token comment">/** 性別(Rawデータ) */</span><br>    <span class="token keyword">val</span> gender <span class="token operator">=</span> RxProperty<span class="token operator">&lt;</span>Gender<span class="token operator">></span><span class="token punctuation">(</span>Gender<span class="token punctuation">.</span>NOT_SET<span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">setValidator</span> <span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">==</span> Gender<span class="token punctuation">.</span>NOT_SET<span class="token punctuation">)</span> <span class="token string">"性別を何か選択してください"</span> <span class="token keyword">else</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><br><br>    <span class="token comment">/** 性別(表示用文字列) */</span><br>    <span class="token keyword">val</span> genderTextResId <span class="token operator">=</span> gender<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span><br>        <span class="token keyword">when</span> <span class="token punctuation">(</span>it<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            Gender<span class="token punctuation">.</span>MAN <span class="token operator">-></span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>male<br>            Gender<span class="token punctuation">.</span>WOMAN <span class="token operator">-></span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>female<br>            Gender<span class="token punctuation">.</span>OTHER <span class="token operator">-></span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>other<br>            <span class="token keyword">else</span> <span class="token operator">-></span> R<span class="token punctuation">.</span>string<span class="token punctuation">.</span>empty<br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toReadOnlyRxProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>    <span class="token comment">/** 利用規約同意 */</span><br>    <span class="token keyword">val</span> isAgreed <span class="token operator">=</span> RxProperty<span class="token operator">&lt;</span>Boolean<span class="token operator">></span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br><br>    <span class="token comment">/** Toast を通知するためだけの LiveData */</span><br>    <span class="token keyword">private</span> <span class="token keyword">val</span> _toast <span class="token operator">=</span> MutableLiveData<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">val</span> toast <span class="token operator">:</span> LiveData<span class="token operator">&lt;</span>String<span class="token operator">></span> <span class="token operator">=</span> _toast<br><br>    <span class="token comment">/** 登録ボタンが実行できるか */</span><br>    <span class="token keyword">private</span> <span class="token keyword">val</span> canRegistration <span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Boolean<span class="token operator">></span> <span class="token operator">=</span> Observable<br>            <span class="token punctuation">.</span><span class="token function">combineLatest</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span><br>                    nickname<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                    gender<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                    birthday<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                    isAgreed<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token punctuation">{</span> anyList <span class="token operator">-></span> anyList<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token keyword">as</span> Boolean <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">all</span> <span class="token punctuation">{</span> it <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br>    <span class="token comment">/** 登録ボタンを押したときのコマンド */</span><br>    <span class="token comment">// canRegistration が true の時だけ実行可能なコマンド</span><br>    <span class="token keyword">val</span> register <span class="token operator">=</span> canRegistration<span class="token punctuation">.</span>toRxCommand<span class="token operator">&lt;</span>NoParameter<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>            <span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">subscribe</span> <span class="token punctuation">{</span><br>                <span class="token comment">// RxCommand の subscribe が呼ばれた時 = ボタンが押された時</span><br>                <span class="token comment">// とりあえずトースト投げる</span><br>                _toast<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token string">"RegistrationCompleteActivity へ移動するよ"</span><span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>disposables<span class="token punctuation">)</span> <span class="token punctuation">}</span><br><br>    <span class="token keyword">fun</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        disposables<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="%E8%A6%81%E7%82%B9%E3%82%92%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B">要点をいくつか <a class="direct-link" href="#%E8%A6%81%E7%82%B9%E3%82%92%E3%81%84%E3%81%8F%E3%81%A4%E3%81%8B">#</a></h2>
<h3 id="%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%81%A8%E3%81%93%E3%82%8D">基本的なところ <a class="direct-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E3%81%A8%E3%81%93%E3%82%8D">#</a></h3>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">/** ニックネーム */</span><br><span class="token keyword">val</span> nickname <span class="token operator">=</span> RxProperty<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">setValidator</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">||</span> it<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span><br>                <span class="token comment">// エラーの場合はその説明を、エラーなしの場合は null を返却</span><br>                <span class="token string">"ニックネームは2文字以上10文字以下にしてください"</span> <span class="token keyword">else</span> <span class="token keyword">null</span> <span class="token punctuation">}</span></code></pre>
<p>これはニックネームを入力する EditText がバインドするプロパティです。<br>
Android DataBinding の場合は、レイアウトXMLで <code>android:text=&quot;@={prop.nickname.value}&quot;</code> なんて書きます。</p>
<p><code>.setValidator()</code> でバリデータを設定しています。ここでは入力値が 2文字未満または10文字より長い場合はエラーメッセージを返し、そうでない場合はエラーがない事を示す <code>null</code> を返します。[^1]</p>
<p>[^1]: 実は標準の <code>.setValidator</code> は引数が <code>(T)-&gt;String</code> になっていて <code>null</code> が返せないので、アプリ内で拡張関数を定義して使っていま、したが RxProperty v4.0.0 で対応してもらえました :tada:</p>
<p>このエラー値もデータバインドできるようになっていて、 <code>android:text=&quot;@{props.nickname.error}&quot;</code> と書いてバインドできます。</p>
<h3 id="%E8%A1%A8%E7%A4%BA%E7%94%A8%E3%81%AB%E5%80%A4%E3%82%92%E5%A4%89%E6%8F%9B">表示用に値を変換 <a class="direct-link" href="#%E8%A1%A8%E7%A4%BA%E7%94%A8%E3%81%AB%E5%80%A4%E3%82%92%E5%A4%89%E6%8F%9B">#</a></h3>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">/** 誕生日(表示用文字列) */</span><br><span class="token keyword">val</span> birthdayText <span class="token operator">=</span> birthday<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span><br>        <span class="token function">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy/MM/dd"</span><span class="token punctuation">,</span> Locale<span class="token punctuation">.</span>JAPAN<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>time<span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toReadOnlyRxProperty</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>
<p><code>RxProperty&lt;Calendar&gt;</code> 型である <code>birthday</code> プロパティを Binding や View 側で文字列に変換するのもできるのですが、せっかくなので Rx ライクにいきましょう。 <code>.map {}</code> でよしなに変換してやるだけです。最後に <code>.toReadOnlyRxProperty()</code> としているのは、このプロパティは読み取り専用、つまり OneWay Bind しか許可しないことを示しています。</p>
<h3 id="%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">コマンド <a class="direct-link" href="#%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">#</a></h3>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token comment">/** 登録ボタンが実行できるか */</span><br><span class="token keyword">private</span> <span class="token keyword">val</span> canRegistration <span class="token operator">:</span> Observable<span class="token operator">&lt;</span>Boolean<span class="token operator">></span> <span class="token operator">=</span> Observable<br>        <span class="token punctuation">.</span><span class="token function">combineLatest</span><span class="token punctuation">(</span><span class="token function">listOf</span><span class="token punctuation">(</span><br>                nickname<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                gender<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                birthday<span class="token punctuation">.</span><span class="token function">onHasErrorsChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> <span class="token operator">!</span>it <span class="token punctuation">}</span><span class="token punctuation">,</span><br>                isAgreed<span class="token punctuation">)</span><span class="token punctuation">,</span><br>                <span class="token punctuation">{</span> anyList <span class="token operator">-></span> anyList<span class="token punctuation">.</span><span class="token function">map</span> <span class="token punctuation">{</span> it <span class="token keyword">as</span> Boolean <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">all</span> <span class="token punctuation">{</span> it <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br><br><span class="token comment">/** 登録ボタンを押したときのコマンド */</span><br><span class="token comment">// canRegistration が true の時だけ実行可能なコマンド</span><br><span class="token keyword">val</span> register <span class="token operator">=</span> canRegistration<span class="token punctuation">.</span>toRxCommand<span class="token operator">&lt;</span>Nothing<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span><span class="token function">apply</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">subscribe</span> <span class="token punctuation">{</span><br>            <span class="token comment">// RxCommand の subscribe が呼ばれた時 = ボタンが押された時</span><br>            <span class="token comment">// とりあえずトースト投げる</span><br>            _toast<span class="token punctuation">.</span><span class="token function">postValue</span><span class="token punctuation">(</span><span class="token string">"RegistrationCompleteActivity へ移動するよ"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>disposables<span class="token punctuation">)</span> <span class="token punctuation">}</span></code></pre>
<p>登録ボタンは、「ニックネーム」、「性別」、「誕生日」がすべて valid であり、さらに 「利用規約に同意」 が <code>true</code> である場合にだけ押すことができる仕様です。<br>
それを定義しているのが <code>canRegistration : Observable&lt;Boolean&gt;</code> です。 「valid かどうか？」 は、 <code>nickname.onHasErrorsChanged().map { !it }</code> のように、「エラーがあるか？」を「エラーがないか？」に反転するだけで表せます。これらを元記事のように <code>Observable.combineLatest</code> でまとめてあげて「入力項目が全て <code>true</code>なら登録ボタンは押せる」となります。</p>
<p>登録ボタンが押されたときの処理は、 <code>register : RxCommand&lt;T&gt;</code> の <code>.subscribe</code> に書きます。ここでは Kotlin の便利な <code>.apply</code> 関数を使って、プロパティの定義とともに書けますね。<br>
実際のボタンが押された処理は、「xxxへ移動するよ」というトーストを表示させるために LiveData に通知を送っています。Activity 側で LiveData を <code>observe</code> して <code>Toast.show</code> を呼んでいます。[^2]</p>
<p>ボタンを RxCommand にバインドするには、レイアウトXMLに <code>app:rxCommandOnClick=&quot;@{props.register}&quot;</code> と書きます。これだけで、登録ボタンは、入力項目が全てvalidになるまでは disabled になります。</p>
<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ <a class="direct-link" href="#%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p><code>ViewProperties</code> を RxProperty を使って書き直してみたところ、行数は 88 から 68 に減りました :thumbsup: 。<br>
行数の削減というよりも、「値を保持する Subject」、「エラー通知用の <code>Observable&lt;bool&gt;</code>」、「データバインディング用の ObservableField」 をそれぞれ用意しなくてもすべて <code>RxProperty&lt;T&gt;</code> の宣言だけでできてしまう事が最大のメリットです。</p>
<p>今回のできあがり品はこちらです。</p>
<p><img src="https://qiita-image-store.s3.amazonaws.com/0/8227/de1f7c2b-6ed4-f273-aaf6-a8e5cf67d737.gif" alt="Untitled.gif"></p>
<p>ソースも公開してるので是非動かして RxProperty の凄さを体験してみてくださいね。 12/8 にリリースされた <a href="https://github.com/k-kagurazaka/rx-property-android/releases/tag/4.0.0">RxProperty 4.0.0</a> にも超速で対応 :exclamation:</p>
<ul>
<li><a href="https://github.com/amay077/RxPropertyFormSample">amay077/RxPropertyFormSample</a></li>
</ul>
<p>[^2]: MVVM だと、 ViewModel の中で View に依存する処理（画面遷移とか、Toast/DialogBoxの表示など）を行うのは抵抗がありますが、MVP ならまあやってもいいかもですね。今回は Toast の表示は Activity 側に任せることにして、 <code>ViewProperties</code> からは EventBus ライクに、 <code>LiveData&lt;String&gt;</code> で通知をするようにしてみました。</p>


published at <time class="postlist-date" datetime="2017-12-08">08 Dec 2017</time>

tags: 

  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/Kotlin/" class="post-tag">Kotlin</a>
  <a href="/tags/RxJava/" class="post-tag">RxJava</a>

<hr>
<ul><li>Next: <a href="/posts/2017-12-10-f8ddea2324cc7d149969/">PowerShell の既定の配色がキツ過ぎたので変えてみた</a></li><li>Previous: <a href="/posts/2017-12-07-0994ebe8e5c815823c97/">リストの中から、条件にマッチした最初のアイテムが何番目かを返すやつ</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2017-12-08-fc075d4e777f8c7a2816/ -->
  </body>
</html>
