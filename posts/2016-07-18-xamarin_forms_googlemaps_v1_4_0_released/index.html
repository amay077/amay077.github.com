<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カスタムマーカーに対応した Xamarin.Forms.GoogleMaps v1.4.0 をリリースしました</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>カスタムマーカーに対応した Xamarin.Forms.GoogleMaps v1.4.0 をリリースしました</h1>

<p>Xamarin.Forms.GoogleMaps v1.4.0 をリリースしました。</p>
<!--more-->
<ul>
<li><a href="https://www.nuget.org/packages/Xamarin.Forms.GoogleMaps/1.4.0">NuGet Xamarin.Forms.GoogleMaps 1.4.0</a></li>
</ul>
<p>待望？のカスタムマーカーに対応しました。</p>
<p><img src="/img/posts/xamarin_forms_googlemaps_v1_4_0_released_001.png" alt="image001"></p>
<h2 id="%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9">カスタムマーカーの使い方 <a class="direct-link" href="#%E3%82%AB%E3%82%B9%E3%82%BF%E3%83%A0%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9">#</a></h2>
<p><code>Pin.Icon</code> に <code>BitmapDescriptorFactory</code> により生成される <code>BitmapDescriptor</code> を設定します。</p>
<p><code>BitmapDescriptorFactory</code> の３つのファクトリメソッドにより、<br>
「デフォルトマーカーの色を変える」「プラットフォーム毎の画像リソースを使用する」「共通の画像リソースを使用する」<br>
の３つが使用できます。</p>
<h3 id="%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%AE%E8%89%B2%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B">デフォルトマーカーの色を変える <a class="direct-link" href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%81%AE%E8%89%B2%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B">#</a></h3>
<p><a href="https://developers.google.com/maps/documentation/ios-sdk/reference/interface_g_m_s_marker.html?hl=ja#ae320cb082a68c22eb1f37955f8e56228"><code>iOS:GMSMarker.markerImageWithColor</code></a>, <a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/BitmapDescriptorFactory.html?hl=ja#defaultMarker(float)"><code>Android:BitmapDescriptorFactory.defaultMarker</code></a> に対応する、既定のマーカー形状の色のみを変える機能です。</p>
<p>以下のように、 <code>BitmapDescriptorFactory.DefaultMarker(Color)</code> メソッドを使用します。</p>
<pre class="language-csharp"><code class="language-csharp">pin<span class="token punctuation">.</span>Icon <span class="token operator">=</span> BitmapDescriptorFactory<span class="token punctuation">.</span><span class="token function">DefaultMarker</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>Pink<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E6%AF%8E%E3%81%AE%E7%94%BB%E5%83%8F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">プラットフォーム毎の画像リソースを使用する <a class="direct-link" href="#%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E6%AF%8E%E3%81%AE%E7%94%BB%E5%83%8F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">#</a></h3>
<p><a href="https://developers.google.com/maps/documentation/ios-sdk/marker?hl=ja#_7"><code>iOS:UIImage.imageNamed</code></a>, <a href="https://developers.google.com/android/reference/com/google/android/gms/maps/model/BitmapDescriptorFactory.html?hl=ja#defaultMarker(float)"><code>Android:BitmapDescriptorFactory.fromAsset</code></a> に対応する、プラットフォーム固有の画像リソースを、マーカー画像として使用する機能です。</p>
<p>以下のように、 <code>BitmapDescriptorFactory.FromBundle(string)</code> メソッドを使用します。</p>
<pre class="language-csharp"><code class="language-csharp">pin<span class="token punctuation">.</span>Icon <span class="token operator">=</span> BitmapDescriptorFactory<span class="token punctuation">.</span><span class="token function">FromBundle</span><span class="token punctuation">(</span><span class="token string">"image01.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>引数の bundleName は、 <strong>同じ名称で</strong> 、プラットフォーム毎に次のように用意されている必要があります。</p>
<h4 id="android-%E3%81%AE%E5%A0%B4%E5%90%88">Android の場合 <a class="direct-link" href="#android-%E3%81%AE%E5%A0%B4%E5%90%88">#</a></h4>
<p>Android側のプロジェクトの <code>Assets</code> ディレクトリ内に <code>image01.png</code> を追加し、 Build Action を ”Android Asset” に設定します。</p>
<p><img src="/img/posts/xamarin_forms_googlemaps_v1_4_0_released_002.png" alt="image001"></p>
<h4 id="ios-%E3%81%AE%E5%A0%B4%E5%90%88">iOS の場合 <a class="direct-link" href="#ios-%E3%81%AE%E5%A0%B4%E5%90%88">#</a></h4>
<p>iOS側のプロジェクト <code>image01.png</code> を追加し、 Build Action を ”BundleResource” に設定します。</p>
<p><img src="/img/posts/xamarin_forms_googlemaps_v1_4_0_released_003.png" alt="image001"></p>
<h3 id="%E5%85%B1%E9%80%9A%E3%81%AE%E7%94%BB%E5%83%8F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">共通の画像リソースを使用する <a class="direct-link" href="#%E5%85%B1%E9%80%9A%E3%81%AE%E7%94%BB%E5%83%8F%E3%83%AA%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">#</a></h3>
<p>画像を <code>Stream</code> を直接指定できる、機能です。</p>
<p>以下のように、 <code>BitmapDescriptorFactory.DefaultMarker(Color)</code> メソッドを使用します。</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token comment">// PCLプロジェクトに EmbeddedResouece として追加した "marker01.png" を読み込んで Stream 化</span><br><span class="token class-name"><span class="token keyword">var</span></span> assembly <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CustomPinsPage</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetTypeInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Assembly<span class="token punctuation">;</span><br><span class="token class-name"><span class="token keyword">var</span></span> stream <span class="token operator">=</span> assembly<span class="token punctuation">.</span><span class="token function">GetManifestResourceStream</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"XFGoogleMapSample.marker01.png"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Stream をマーカーに設定</span><br>pin<span class="token punctuation">.</span>Icon <span class="token operator">=</span> BitmapDescriptorFactory<span class="token punctuation">.</span><span class="token function">FromStream</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2 id="%E3%80%90%E6%B3%A8%E6%84%8F%E3%80%91%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E6%AF%8E%E3%81%AE%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E9%81%95%E3%81%84">【注意】プラットフォーム毎のマーカーサイズの違い <a class="direct-link" href="#%E3%80%90%E6%B3%A8%E6%84%8F%E3%80%91%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E6%AF%8E%E3%81%AE%E3%83%9E%E3%83%BC%E3%82%AB%E3%83%BC%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%AE%E9%81%95%E3%81%84">#</a></h2>
<p>「プラットフォーム毎の画像リソースを使用する」「共通の画像リソースを使用する」で見られる現象なのですが、iOS と Android では <strong>同じサイズの画像を指定しているのに iOS の方が大きく描画されます</strong></p>
<p><img src="/img/posts/xamarin_forms_googlemaps_v1_4_0_released_004.png" alt="image001"></p>
<p>なぜこうなるのか分かりませんが、 <a href="https://developers.google.com/maps/documentation/ios-sdk/intro?hl=ja">Google Maps SDK for iOS</a> と <a href="https://developers.google.com/maps/documentation/android-api/intro?hl=ja">Google Maps Android API</a> を直接使用した時もこうなるので、両者の仕様というかプラットフォーム自体の仕様なのかも知れません。</p>
<p>特に <code>BitmapDescriptorFactory.FromStream</code> を使用した時には使い勝手が悪いのですが、「ネイティブの Google Maps SDK の機能を共通APIでラップする」のが第一目標なので、とりあえず画像を何も加工しない実装でリリースしました。</p>
<p>何か原因などについてヒントがある方は</p>
<ul>
<li><a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/issues/40">Why custom pin icon in iOS bigger than Android? · Issue #40 · amay077/Xamarin.Forms.GoogleMaps</a></li>
</ul>
<p>に書いてもらえると助かります（日本語で大丈夫です）。</p>
<h2 id="%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0">サンプルプログラム <a class="direct-link" href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%A0">#</a></h2>
<p><a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/tree/master/XFGoogleMapSample">XFGoogleMapSample</a> の <a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps/blob/master/XFGoogleMapSample/XFGoogleMapSample/CustomPinsPage.xaml.cs"><code>CustomPinsPage.xaml.cs</code></a> でこれらの機能を使用しています。</p>
<p>是非使ってみてください。よければ <a href="https://github.com/amay077/Xamarin.Forms.GoogleMaps">Github リポジトリ</a> に Star ください。</p>


published at <time class="postlist-date" datetime="2016-07-18">18 Jul 2016</time>

tags: 

  <a href="/tags/Xamarin/" class="post-tag">Xamarin</a>
  <a href="/tags/Xamarin.Forms/" class="post-tag">Xamarin.Forms</a>
  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/iOS/" class="post-tag">iOS</a>
  <a href="/tags/GoogleMapsAPI/" class="post-tag">GoogleMapsAPI</a>
  <a href="/tags/ReleaseNotes/" class="post-tag">ReleaseNotes</a>
  <a href="/tags/Xamarin.Forms.GoogleMaps/" class="post-tag">Xamarin.Forms.GoogleMaps</a>

<hr>
<ul><li>Next: <a href="/posts/2016-07-19-comparison_async_logic_with_java_swift_xamarin/">非同期処理の書き方を Java と Swift と Xamarin で比較する</a></li><li>Previous: <a href="/posts/2016-07-15-comparison_on_click_with_java_swift_xamarin/">ボタンをタップした時に○○する、を Java と Swift と Xamarin で比較する</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2016-07-18-xamarin_forms_googlemaps_v1_4_0_released/ -->
  </body>
</html>
