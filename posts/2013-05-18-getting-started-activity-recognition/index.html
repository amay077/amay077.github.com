<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google I/O 2013 で発表された行動認識(Activity Recognition)を使ってみる</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>Google I/O 2013 で発表された行動認識(Activity Recognition)を使ってみる</h1>

<p><a href="http://www.gizmodo.jp/2013/05/android_52.html">Google I/O で発表</a>された Android の行動認識(動作認識)機能ですが、これは <a href="http://developer.android.com/google/play-services/index.html">Google Play Services</a> で提供されているので、新しい API Ver でなくても(Froyo でも！)使えます、すばらしい！</p>
<p>というわけで、早速使ってみました。</p>
<!--more-->
<h2 id="1.-sdk-%E3%81%AE-google-play-services-%E3%82%92%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">1. SDK の Google Play Services を更新する <a class="direct-link" href="#1.-sdk-%E3%81%AE-google-play-services-%E3%82%92%E6%9B%B4%E6%96%B0%E3%81%99%E3%82%8B">#</a></h2>
<p><img src="/img/posts/getting_started_activity_recognition1.png" alt="image1"></p>
<p>SDK Manager で、Google Play service を最新に更新します。<br>
私は勢いで Android SDK Tools なども最新にしてしまいましたが、これが必要だったかは定かでないです。また SDK Tools を更新したら Eclipse のプラグインも更新する必要がありました。</p>
<h2 id="2.-eclipse-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B">2. Eclipse でプロジェクトを作る <a class="direct-link" href="#2.-eclipse-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h2>
<p>Android Studio は使ってません(まだよくわからないので)<br>
Eclipse で、いつもどおりに Android のプロジェクトを作ります。<br>
Fragment も使いませんよ、古きよき、BlankActivity なプロジェクトです。<br>
名前はここでは <code>ActivityRecognizingSample</code> とします。</p>
<h2 id="3.-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB-google-play-services_lib-%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">3. プロジェクトに google-play-services_lib を追加する <a class="direct-link" href="#3.-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB-google-play-services_lib-%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">#</a></h2>
<p>Google Play services を使うために、SDK のフォルダにある google-play-services_lib が必要です。</p>
<p>Ecplise の Import で <code>{your sdk location}/extras/google/google_play_services/libproject/google-play-services_lib</code> を選択します。自分の Workspace に Copy しておいた方が無難でしょう。</p>
<p>コピーしたら、ActivityRecognizingSample で、 google-play-services_lib をライブラリ参照します。</p>
<p><img src="/img/posts/getting_started_activity_recognition2.png" alt="image2"></p>
<p>次から ActivityRecognizingSample の実装です。</p>
<h2 id="4.-intentservice-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%94%A8%E6%84%8F">4. IntentService クラスの用意 <a class="direct-link" href="#4.-intentservice-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E7%94%A8%E6%84%8F">#</a></h2>
<p>行動認識結果は IntentService で受け取ります。そのためのクラス <code>ReceiveRecognitionIntentService</code> を作成します。</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>activityrecognizingsample</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">IntentService</span><span class="token punctuation">;</span><br><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveRecognitionIntentService</span> <span class="token keyword">extends</span> <span class="token class-name">IntentService</span> <span class="token punctuation">{</span><br><br>	<span class="token keyword">public</span> <span class="token class-name">ReceiveRecognitionIntentService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">"ReceiveRecognitionIntentService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token annotation punctuation">@Override</span><br>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onHandleIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// まだ未実装</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="5.-androidmanifest.xml-%E3%81%AE%E7%B7%A8%E9%9B%86">5. AndroidManifest.xml の編集 <a class="direct-link" href="#5.-androidmanifest.xml-%E3%81%AE%E7%B7%A8%E9%9B%86">#</a></h2>
<p>行動認識を使うための権限 <code>com.google.android.gms.permission.ACTIVITY_RECOGNITION</code> をマニフェストに追加します。<br>
あと、ReceiveRecognitionIntentService も忘れずに追加しておきます。<br>
細かいところでは、MainActivity の画面の向きを縦（Portrait）に固定しておきます。試している時に画面の向きが変わると面倒なので。</p>
<pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>manifest</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><br>    <span class="token attr-name">package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.activityrecognizingsample<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>versionCode</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>versionName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.0<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-sdk</span><br>        <span class="token attr-name"><span class="token namespace">android:</span>minSdkVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>targetSdkVersion</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>17<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uses-permission</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.google.android.gms.permission.ACTIVITY_RECOGNITION<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>application</span><br>        <span class="token attr-name"><span class="token namespace">android:</span>allowBackup</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>icon</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@drawable/ic_launcher<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/app_name<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@style/AppTheme<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activity</span><br>            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.MainActivity<span class="token punctuation">"</span></span><br>            <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/app_name<span class="token punctuation">"</span></span> <br>            <span class="token attr-name"><span class="token namespace">android:</span>screenOrientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>portrait<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.action.MAIN<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>android.intent.category.LAUNCHER<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activity</span><span class="token punctuation">></span></span><br>        <br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span> <br>            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.ReceiveRecognitionIntentService<span class="token punctuation">"</span></span>   <br>            <span class="token attr-name"><span class="token namespace">android:</span>label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@string/app_name<span class="token punctuation">"</span></span><br>    		<span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>application</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>manifest</span><span class="token punctuation">></span></span></code></pre>
<h2 id="6.-%E8%A1%8C%E5%8B%95%E8%AA%8D%E8%AD%98%E3%82%AF%E3%83%A9%E3%82%B9(activityrecognitionclient)%E3%82%92%E4%BD%BF%E3%81%86">6. 行動認識クラス(ActivityRecognitionClient)を使う <a class="direct-link" href="#6.-%E8%A1%8C%E5%8B%95%E8%AA%8D%E8%AD%98%E3%82%AF%E3%83%A9%E3%82%B9(activityrecognitionclient)%E3%82%92%E4%BD%BF%E3%81%86">#</a></h2>
<p>ここから、一気に行きます。</p>
<p>行動認識には <a href="http://developer.android.com/reference/com/google/android/gms/location/ActivityRecognitionClient.html"><code>ActivityRecognitionClient</code></a> を使います。</p>
<p>大雑把な使い方は、</p>
<ol>
<li>インスタンスを生成する</li>
<li><code>connect</code> を呼ぶ -&gt; <code>ConnectionCallbacks.onConnected</code> がコールバックされる</li>
<li><code>requestActivityUpdates</code> に <code>ReceiveRecognitionIntentService</code> を仕掛けて、呼ぶ。 -&gt; <code>ReceiveRecognitionIntentService.onHandleIntent</code> が呼ばれる</li>
<li><code>onHandleIntent</code> で <code>ActivityRecognitionResult</code> にて結果を取得する</li>
</ol>
<p>です。</p>
<p>その後、認識結果を画面に表示するために、</p>
<ol start="5">
<li>予め、<code>MainActivity</code> に <code>BroadcastReceiver</code> を仕掛けておく</li>
<li><code>ReceiveRecognitionIntentService.onHandleIntent</code> で取得した認識結果を、Broadcast する。</li>
</ol>
<p>とします。</p>
<p>では全コードをどうぞ。</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>activityrecognizingsample</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">ConnectionResult</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">GooglePlayServicesClient<span class="token punctuation">.</span>ConnectionCallbacks</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">GooglePlayServicesClient<span class="token punctuation">.</span>OnConnectionFailedListener</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">ActivityRecognitionClient</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">DetectedActivity</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">PendingIntent</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">BroadcastReceiver</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Intent</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">IntentFilter</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>text<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateFormat</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Menu</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Button</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">TextView</span><span class="token punctuation">;</span><br><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">Activity</span> <span class="token punctuation">{</span><br>    <span class="token keyword">private</span> <span class="token class-name">ActivityRecognitionClient</span> _recClient<span class="token punctuation">;</span> <span class="token comment">// 行動認識のメインクラス</span><br>	<span class="token keyword">private</span> <span class="token class-name">TextView</span> _textResult<span class="token punctuation">;</span> <span class="token comment">// 認識結果を表示するところ</span><br>	<br>	<span class="token comment">// 認識結果は PendingIntent で通知してくれる</span><br>	<span class="token comment">//  PendingIntent に、Service を起動する Intent を仕込んでおいて、</span><br>	<span class="token comment">//  認識結果の取得はそっちで行う。 > ReceiveRecognitionIntentService.java</span><br>    <span class="token keyword">private</span> <span class="token class-name">PendingIntent</span> _receiveRecognitionIntent<span class="token punctuation">;</span> <br>    <br>    <span class="token comment">// ReceiveRecognitionIntentService で取得した認識結果は、Broadcast で通知されるので、</span><br>    <span class="token comment">// それを受け取る Receiver 。ここで画面に認識結果を表示する。</span><br>	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BroadcastReceiver</span> _receiveFromIntentService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token annotation punctuation">@Override</span><br>		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token keyword">final</span> <span class="token keyword">int</span> activityType <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span><span class="token string">"activity_type"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token keyword">final</span> <span class="token keyword">int</span> confidence <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getIntExtra</span><span class="token punctuation">(</span><span class="token string">"confidence"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token keyword">final</span> <span class="token keyword">long</span> time <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getLongExtra</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<br>			<span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">runOnUiThread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token annotation punctuation">@Override</span><br>				<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>					<span class="token class-name">String</span> text <span class="token operator">=</span> _textResult<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>					text <span class="token operator">=</span> <span class="token class-name">DateFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"hh:mm:ss.sss"</span><span class="token punctuation">,</span> time<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" - "</span> <br>							<span class="token operator">+</span> <span class="token function">getNameFromType</span><span class="token punctuation">(</span>activityType<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"("</span> <span class="token operator">+</span><br>							<span class="token operator">+</span> confidence <span class="token operator">+</span> <span class="token string">")"</span> <span class="token operator">+</span> <span class="token string">"\n"</span> <span class="token operator">+</span> text<span class="token punctuation">;</span><br>					<br>					_textResult<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token punctuation">}</span><br>			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><br>		<br>		<span class="token comment">// http://developer.android.com/training/location/activity-recognition.html</span><br>		<span class="token comment">// からパクってきた関数</span><br>		 <span class="token comment">/**<br>	     * Map detected activity types to strings<br>	     *@param activityType The detected activity type<br>	     *@return A user-readable name for the type<br>	     */</span><br>	    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getNameFromType</span><span class="token punctuation">(</span><span class="token keyword">int</span> activityType<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	        <span class="token keyword">switch</span><span class="token punctuation">(</span>activityType<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>IN_VEHICLE<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"in_vehicle"</span><span class="token punctuation">;</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>ON_BICYCLE<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"on_bicycle"</span><span class="token punctuation">;</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>ON_FOOT<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"on_foot"</span><span class="token punctuation">;</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>STILL<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"still"</span><span class="token punctuation">;</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>UNKNOWN<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"unknown"</span><span class="token punctuation">;</span><br>	            <span class="token keyword">case</span> <span class="token class-name">DetectedActivity</span><span class="token punctuation">.</span>TILTING<span class="token operator">:</span><br>	                <span class="token keyword">return</span> <span class="token string">"tilting"</span><span class="token punctuation">;</span><br>	        <span class="token punctuation">}</span><br>	        <span class="token keyword">return</span> <span class="token string">"unknown - "</span> <span class="token operator">+</span> activityType<span class="token punctuation">;</span><br>	    <span class="token punctuation">}</span><br>	<span class="token punctuation">}</span><span class="token punctuation">;</span><br>	<br>    <span class="token annotation punctuation">@Override</span><br>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <br>        _textResult <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>text_results<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <br>        <span class="token comment">// IntentService から Broadcast される認識結果を受け取るための Receiver を登録しておく</span><br>        <span class="token function">registerReceiver</span><span class="token punctuation">(</span>_receiveFromIntentService<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token string">"receive_recognition"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <br>        <span class="token keyword">final</span> <span class="token class-name">Button</span> buttonStart <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>button_start<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        buttonStart<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        	<span class="token keyword">private</span> <span class="token keyword">boolean</span> _isStarted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>        	<br>			<span class="token annotation punctuation">@Override</span><br>			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<br>				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_isStarted<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>					<span class="token function">startReckoning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>					buttonStart<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Stop"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>					<span class="token function">stopReckoning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>					buttonStart<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"Start"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<span class="token punctuation">}</span><br>				<br>				_isStarted <span class="token operator">=</span> <span class="token operator">!</span>_isStarted<span class="token punctuation">;</span><br>			<span class="token punctuation">}</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token annotation punctuation">@Override</span><br>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    	<span class="token function">stopReckoning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token comment">// ConnectionCallbacks.onDisconnected が呼ばれるまで待った方がいい気がする</span><br>    	<span class="token function">unregisterReceiver</span><span class="token punctuation">(</span>_receiveFromIntentService<span class="token punctuation">)</span><span class="token punctuation">;</span><br>    	<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">startReckoning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    	_recClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActivityRecognitionClient</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<br>			<span class="token annotation punctuation">@Override</span><br>			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConnected</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> bundle<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><br>		                <span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">ReceiveRecognitionIntentService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>				_receiveRecognitionIntent <span class="token operator">=</span> <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><br>						<span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> intent<span class="token punctuation">,</span><br>		                <span class="token class-name">PendingIntent</span><span class="token punctuation">.</span>FLAG_UPDATE_CURRENT<span class="token punctuation">)</span><span class="token punctuation">;</span><br>				<br>				<span class="token comment">// 2. 行動認識開始！</span><br>				<span class="token comment">//  1秒間隔で認識間隔を通知。</span><br>				<span class="token comment">//  認識したら ReceiveRecognitionIntentService が呼び出されるようにしている。</span><br>				_recClient<span class="token punctuation">.</span><span class="token function">requestActivityUpdates</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> _receiveRecognitionIntent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>			<span class="token punctuation">}</span><br><br>			<span class="token annotation punctuation">@Override</span><br>			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDisconnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				_recClient <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// NOTE disconnect してもここにこないよ？</span><br>			<span class="token punctuation">}</span><br><br>    	<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">OnConnectionFailedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token annotation punctuation">@Override</span><br>			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onConnectionFailed</span><span class="token punctuation">(</span><span class="token class-name">ConnectionResult</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>				<span class="token comment">// 接続でエラーが発生したらここにくるらしい</span><br>			<span class="token punctuation">}</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    	<br>    	<span class="token comment">// 1. 行動認識サービスに接続！</span><br>    	_recClient<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">stopReckoning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    	<span class="token keyword">if</span> <span class="token punctuation">(</span>_recClient <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>_recClient<span class="token punctuation">.</span><span class="token function">isConnected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    		<span class="token keyword">return</span><span class="token punctuation">;</span><br>    	<span class="token punctuation">}</span><br>    	<br>    	_recClient<span class="token punctuation">.</span><span class="token function">removeActivityUpdates</span><span class="token punctuation">(</span>_receiveRecognitionIntent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		_recClient<span class="token punctuation">.</span><span class="token function">disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <br>		<span class="token comment">// ConnectionCallbacks.onDisconnected が呼ばれるまで待った方がいい気がする</span><br>    <span class="token punctuation">}</span><br>    <br>    <br><span class="token punctuation">}</span></code></pre>
<pre class="language-java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>activityrecognizingsample</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">ActivityRecognitionResult</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>android<span class="token punctuation">.</span>gms<span class="token punctuation">.</span>location<span class="token punctuation">.</span></span><span class="token class-name">DetectedActivity</span><span class="token punctuation">;</span><br><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">IntentService</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Intent</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>text<span class="token punctuation">.</span>format<span class="token punctuation">.</span></span><span class="token class-name">DateFormat</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span><span class="token punctuation">;</span><br><br><span class="token comment">/**<br> * 行動認識結果を取得するための IntentService <br> * <br> * ActivityRecognitionClient.requestActivityUpdates に仕込んでおくと<br> * 認識結果を受信する度にこれが呼ばれる。<br> * <br> */</span><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReceiveRecognitionIntentService</span> <span class="token keyword">extends</span> <span class="token class-name">IntentService</span> <span class="token punctuation">{</span><br>	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">"ReceiveRecognitionIntentService"</span><span class="token punctuation">;</span><br><br>	<span class="token keyword">public</span> <span class="token class-name">ReceiveRecognitionIntentService</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span><br>		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">"ReceiveRecognitionIntentService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><br>	<span class="token annotation punctuation">@Override</span><br>	<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onHandleIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ActivityRecognitionResult</span><span class="token punctuation">.</span><span class="token function">hasResult</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token comment">// 行動認識結果持ってないよ</span><br>			<span class="token keyword">return</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><br>		<br>		<span class="token comment">// 認識結果を取得する</span><br>		<span class="token class-name">ActivityRecognitionResult</span> result <span class="token operator">=</span> <br>				<span class="token class-name">ActivityRecognitionResult</span><span class="token punctuation">.</span><span class="token function">extractResult</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<br>		<span class="token class-name">DetectedActivity</span> mostProbableActivity <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">getMostProbableActivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">int</span> activityType <span class="token operator">=</span> mostProbableActivity<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">int</span> confidence <span class="token operator">=</span> mostProbableActivity<span class="token punctuation">.</span><span class="token function">getConfidence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<br>		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Receive recognition."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">" activityType - "</span> <span class="token operator">+</span> activityType<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 行動タイプ</span><br>		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">" confidence - "</span> <span class="token operator">+</span> confidence<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 確実性（精度みたいな）</span><br>		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">" time - "</span> <span class="token operator">+</span> <span class="token class-name">DateFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"hh:mm:ss.sss"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 時間</span><br>		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">" elapsedTime - "</span> <span class="token operator">+</span> <span class="token class-name">DateFormat</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"hh:mm:ss.sss"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getElapsedRealtimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// よく分からん</span><br><br>		<span class="token comment">// 画面に結果を表示するために、Broadcast で通知。</span><br>		<span class="token comment">//  MainActivity にしかけた BroadcastReceiver で受信する。</span><br>		<span class="token class-name">Intent</span> notifyIntent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">"receive_recognition"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		notifyIntent<span class="token punctuation">.</span><span class="token function">setPackage</span><span class="token punctuation">(</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		notifyIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"activity_type"</span><span class="token punctuation">,</span> activityType<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		notifyIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"confidence"</span><span class="token punctuation">,</span> confidence<span class="token punctuation">)</span><span class="token punctuation">;</span><br>		notifyIntent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"time"</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token function">sendBroadcast</span><span class="token punctuation">(</span>notifyIntent<span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="7.-%E5%8B%95%E3%81%8F%E3%81%AE%E3%81%8B%EF%BC%81%EF%BC%9F">7. 動くのか！？ <a class="direct-link" href="#7.-%E5%8B%95%E3%81%8F%E3%81%AE%E3%81%8B%EF%BC%81%EF%BC%9F">#</a></h2>
<p>HTC J(not蝶) で動かしてみました。</p>
<p><img src="/img/posts/getting_started_activity_recognition3.jpg" alt="image3"></p>
<p>on_foot ってのが「歩いてる」ってやつですね。<br>
感覚としてはズボンの尻ポケに入れて、5mくらいは歩かないと認識されない感じ。結構 unknown が多いですね。</p>
<p>クルマは、ダッシュボードに放置して運転してみたもの。開始から１分経たずに認識できています。</p>
<p>自転車は、最初クルマと誤認したものの、その後認識しました。</p>
<p>ここでは教科書通りの使い方をしましたが、なかなか感動します。</p>
<h3 id="2013.5.21%E8%BF%BD%E8%A8%98-%E9%9B%BB%E8%BB%8A%E3%81%A0%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%EF%BC%9F">2013.5.21追記 電車だとどうなる？ <a class="direct-link" href="#2013.5.21%E8%BF%BD%E8%A8%98-%E9%9B%BB%E8%BB%8A%E3%81%A0%E3%81%A8%E3%81%A9%E3%81%86%E3%81%AA%E3%82%8B%EF%BC%9F">#</a></h3>
<p>東京に出張する機会があったので、新幹線と在来線でも試してみました。</p>
<p><img src="/img/posts/getting_started_activity_recognition4.png" alt="image4"></p>
<p>新幹線は窓側の席だったので、窓の机に端末を放置していました。<br>
在来線は座ることができなかったので、立った状態で端末は尻ポケ、カベに持たれてなるべく動かないようにしていました。</p>
<p>結果は、在来線ではなんとか vehicle と認識されましたが、新幹線では認識できませんでした。<br>
恐らく、新幹線は揺れが少なすぎるのだと思います。優秀ですね、日本の新幹線。</p>
<h3 id="2013.5.27-%E8%BF%BD%E8%A8%98-%E4%BD%8D%E7%BD%AE%E6%83%85%E5%A0%B1%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B%E3%81%A8%E7%B2%BE%E5%BA%A6%E3%81%8C%E4%B8%8A%E3%81%8C%E3%82%8B%EF%BC%9F">2013.5.27 追記 位置情報を許可すると精度が上がる？ <a class="direct-link" href="#2013.5.27-%E8%BF%BD%E8%A8%98-%E4%BD%8D%E7%BD%AE%E6%83%85%E5%A0%B1%E3%82%92%E8%A8%B1%E5%8F%AF%E3%81%99%E3%82%8B%E3%81%A8%E7%B2%BE%E5%BA%A6%E3%81%8C%E4%B8%8A%E3%81%8C%E3%82%8B%EF%BC%9F">#</a></h3>
<p><a href="https://twitter.com/sos_jp">@sos_jp</a> さんの記事、</p>
<ul>
<li><a href="http://sos.hatenablog.jp/entry/2013/05/19/162122">Google Play servicesの新機能 - Activity Recognition - sos の 作業メモ</a></li>
</ul>
<p>によりますと、</p>
<blockquote>
<p>位置情報があるとより正確な判定になるようです</p>
</blockquote>
<p>とのことなので、もしかしたら FINE(+COURSE)_LOCATION とか付けとくと新幹線でも vechicle と認識デキるかもしれません。いずれ試してみます。</p>
<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ <a class="direct-link" href="#%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p>公式のコンプリートな Getting Started は</p>
<ul>
<li><a href="http://developer.android.com/training/location/activity-recognition.html">Recognizing the User's Current Activity ｜ Android Developers</a></li>
</ul>
<p>にありますので、こちらを読まれた方が確実です。</p>
<p>ここで作ったサンプルは、</p>
<ul>
<li><a href="https://github.com/amay077/androidactivityrecognizingsample">amay077/androidactivityrecognizingsample · GitHub</a></li>
</ul>
<p>に置いておきます。</p>


published at <time class="postlist-date" datetime="2013-05-18">18 May 2013</time>

tags: 

  <a href="/tags/Android/" class="post-tag">Android</a>

<hr>
<ul><li>Next: <a href="/posts/2013-05-20-digest-of-android-location-session-in-google-io2013/">Google I/O 2013 の Android Location セッションまとめ</a></li><li>Previous: <a href="/posts/2013-05-16-xamarin-android-fail-build-on-latest-android-sdk/">Android SDK を最新の r22 にしたら、Xamarin.Android でビルドできなくなった件</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/2013-05-18-getting-started-activity-recognition/ -->
  </body>
</html>
