<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C# 使いが Kotlin を使ってみて「いいな」と思ったトコ</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>C# 使いが Kotlin を使ってみて「いいな」と思ったトコ</h1>

<p>最近 Kotlin をよく使っているので、 C# とくらべて「お、これはイイな！」と思ったところを挙げてみました、今後足してく予定。</p>
<!--more-->
<p>これ↓も似たような話かな。</p>
<ul>
<li><a href="https://qiita.com/amay077/items/37e1032f2a8f30138284">C# + ReactiveProperty vs Kotlin + RxProperty : Command 編 - Qiita</a></li>
</ul>
<h2 id="%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%A9%E3%82%B9">データクラス <a class="direct-link" href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%82%AF%E3%83%A9%E3%82%B9">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressCard</span> <br><span class="token punctuation">{</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Phone <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br>  <br>  <span class="token keyword">public</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> phone<span class="token punctuation">)</span><br>  <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>Phone <span class="token operator">=</span> phone<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">data</span> <span class="token keyword">class</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><span class="token keyword">val</span> name<span class="token operator">:</span>String<span class="token punctuation">,</span> <span class="token keyword">val</span> phone<span class="token operator">:</span>String<span class="token punctuation">)</span><br><br><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>   <span class="token keyword">val</span> card <span class="token operator">=</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"phone"</span><span class="token punctuation">)</span><br>   <span class="token keyword">val</span> copied <span class="token operator">=</span> card<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"hoge"</span><span class="token punctuation">)</span> <span class="token comment">// 指定したプロパティだけ値を変えて複製してくれる</span><br><span class="token punctuation">}</span></code></pre>
<p>圧倒的短さ！ &amp; <code>copy</code> メソッドなにこれすごい！<br>
Json のモデルクラスを作る時にはほんと便利。</p>
<h2 id="%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%AE%E7%9C%81%E7%95%A5">型定義の省略 <a class="direct-link" href="#%E5%9E%8B%E5%AE%9A%E7%BE%A9%E3%81%AE%E7%9C%81%E7%95%A5">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressCard</span> <br><span class="token punctuation">{</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name">ObservableField<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ObservableField<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name">IDictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span> Map <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Dictionary<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> AddressCard <span class="token punctuation">{</span><br>  <span class="token keyword">val</span> name <span class="token operator">=</span> ObservableField<span class="token operator">&lt;</span>String<span class="token operator">></span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><br>  <span class="token keyword">val</span> map <span class="token operator">=</span> HashMap<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// これは悪手。public ならちゃんと map:Map&lt;String, String> と基本抽象型にすべき</span><br><span class="token punctuation">}</span></code></pre>
<p>圧倒的短さ！<br>
これが型を後ろに書く言語の強みなのか？？？</p>
<h2 id="%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E5%BC%95%E6%95%B0%E3%82%92%E3%83%A1%E3%83%B3%E3%83%90%E5%A4%89%E6%95%B0%E3%81%AB%E5%85%A5%E3%82%8C%E3%82%8B%E3%82%84%E3%81%A4">コンストラクタ引数をメンバ変数に入れるやつ <a class="direct-link" href="#%E3%82%B3%E3%83%B3%E3%82%B9%E3%83%88%E3%83%A9%E3%82%AF%E3%82%BF%E5%BC%95%E6%95%B0%E3%82%92%E3%83%A1%E3%83%B3%E3%83%90%E5%A4%89%E6%95%B0%E3%81%AB%E5%85%A5%E3%82%8C%E3%82%8B%E3%82%84%E3%81%A4">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressCard</span> <br><span class="token punctuation">{</span><br>  <span class="token keyword">public</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> _name<span class="token punctuation">;</span><br>  <span class="token keyword">public</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> _phone<span class="token punctuation">;</span><br>  <br>  <span class="token keyword">public</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> phone<span class="token punctuation">)</span><br>  <span class="token punctuation">{</span><br>    _name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>    _phone <span class="token operator">=</span> phone<span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><br>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> <span class="token function">ToFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_name</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_phone</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><br>  <span class="token keyword">private</span> <span class="token keyword">val</span> name<span class="token operator">:</span>String<span class="token punctuation">,</span> <br>  <span class="token keyword">private</span> <span class="token keyword">val</span> phone<span class="token operator">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <br>  <span class="token keyword">fun</span> <span class="token function">toFullName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">${</span>name<span class="token delimiter variable">}</span></span>:{phone}"</span><br><span class="token punctuation">}</span></code></pre>
<p>代入の必要ナシ！<br>
そもそもプライマリコンストラクタの引数はそのままプロパティになる模様（<code>val</code> を付けない場合はイニシャライザ <code>init {}</code> の中でのみ参照可能な変数になるとのことです、コメントで教えていただきました）。</p>
<h2 id="%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E5%B0%82%E7%94%A8%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B">読み取り専用かどうか <a class="direct-link" href="#%E8%AA%AD%E3%81%BF%E5%8F%96%E3%82%8A%E5%B0%82%E7%94%A8%E3%81%8B%E3%81%A9%E3%81%86%E3%81%8B">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AddressCard</span> <br><span class="token punctuation">{</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 読み取り専用プロパティ</span><br>  <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Phone <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment">// 書き込み可プロパティ</span><br><br>  <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name"><span class="token keyword">string</span></span> _fullName<span class="token punctuation">;</span> <span class="token comment">// 読み取り専用フィールド</span><br>  <br>  <span class="token keyword">public</span> <span class="token function">AddressCard</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> name<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> phone<span class="token punctuation">)</span><br>  <span class="token punctuation">{</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>Name <span class="token operator">=</span> name<span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>Phone <span class="token operator">=</span> phone<span class="token punctuation">;</span><br>    _fullName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_name</span><span class="token punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token punctuation">{</span><span class="token expression language-csharp">_phone</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> AddressCard <span class="token punctuation">{</span><br><br>  <span class="token keyword">val</span> name<span class="token operator">:</span>String   <span class="token comment">// 読み取り専用プロパティ</span><br>  <span class="token keyword">var</span> phone<span class="token operator">:</span>String  <span class="token comment">// 書き込み可プロパティ</span><br><br>  <span class="token keyword">private</span> <span class="token keyword">val</span> _fullName<span class="token operator">:</span>String <span class="token comment">// 非公開読み取り専用プロパティ</span><br><br>  <span class="token keyword">constructor</span><span class="token punctuation">(</span>name<span class="token operator">:</span>String<span class="token punctuation">,</span> phone<span class="token operator">:</span>String<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 敢えてのコンストラクタ</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<br>    <span class="token keyword">this</span><span class="token punctuation">.</span>phone <span class="token operator">=</span> phone<br>    _fullName <span class="token operator">=</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">${</span>name<span class="token delimiter variable">}</span></span>:{phone}"</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>いかなるケースでも <code>val</code> と <code>var</code> の使い分けだけで済むのがイイ！</p>
<h2 id="%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%82-null-%E3%82%92%E6%8E%92%E9%99%A4%E3%81%A7%E3%81%8D%E3%82%8B">クラスでも <code>null</code> を排除できる <a class="direct-link" href="#%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%A7%E3%82%82-null-%E3%82%92%E6%8E%92%E9%99%A4%E3%81%A7%E3%81%8D%E3%82%8B">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">class</span> <span class="token class-name">HogeClass</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><br><span class="token keyword">struct</span> <span class="token class-name">HogeStruct</span> <span class="token punctuation">{</span>  <span class="token punctuation">}</span><br><br><span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>   <span class="token class-name">HogeClass</span> hogeClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできる   </span><br>   <span class="token class-name">HogeStruct</span> hogeStruct <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできない</span><br>   <span class="token class-name">HogeStruct<span class="token punctuation">?</span></span> nullableHoge <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできる</span><br>   <span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> num <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできる</span><br>   <br>   <span class="token comment">// null条件/合体演算子</span><br>   Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>hogeClass<span class="token punctuation">?.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>   Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>num<span class="token punctuation">?.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token string">"empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">class</span> HogeClass <span class="token punctuation">{</span>  <span class="token punctuation">}</span><br><br><span class="token keyword">fun</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">{</span><br>   <span class="token keyword">val</span> hogeClass<span class="token operator">:</span>HogeClass <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできない</span><br>   <span class="token keyword">val</span> nullableHoge<span class="token operator">:</span>HogeClass<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできる</span><br>   <span class="token keyword">val</span> num<span class="token operator">:</span>Int<span class="token operator">?</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// null にできる</span><br>   <br>   <span class="token comment">// null条件/合体演算子</span><br>   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>nullableHoge<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">"empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>   System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>num<span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?:</span> <span class="token string">"empty"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>末端関数において、 <code>null</code> になる可能性を排除して実装できる安心感パない。<br>
(C# でも構造体を多用すればできるけど、目的が違うし実質ムリ)</p>
<h2 id="%22%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84%E5%BC%95%E6%95%B0%22-%E3%82%92%E6%98%8E%E7%A4%BA%E3%81%A7%E3%81%8D%E3%82%8B">&quot;使用しない引数&quot; を明示できる <a class="direct-link" href="#%22%E4%BD%BF%E7%94%A8%E3%81%97%E3%81%AA%E3%81%84%E5%BC%95%E6%95%B0%22-%E3%82%92%E6%98%8E%E7%A4%BA%E3%81%A7%E3%81%8D%E3%82%8B">#</a></h2>
<p>C#</p>
<pre class="language-csharp"><code class="language-csharp">button<span class="token punctuation">.</span>Clicked <span class="token operator">+=</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> __<span class="token punctuation">)</span> <span class="token operator">=></span>  <span class="token comment">// _ は２度使えない</span><br><span class="token punctuation">{</span><br>    <span class="token class-name"><span class="token keyword">var</span></span> hoge1 <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 変数名が _ なだけ</span><br>    <span class="token class-name"><span class="token keyword">var</span></span> hoge2 <span class="token operator">=</span> __<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 変数名が __ なだけ</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>Kotlin</p>
<pre class="language-kotlin"><code class="language-kotlin">button<span class="token punctuation">.</span><span class="token function">setOnHoverListener</span><span class="token punctuation">(</span><span class="token punctuation">{</span> _<span class="token punctuation">,</span> _ <span class="token operator">-></span>  <span class="token comment">// _ は何度でも使える！</span><br>    <span class="token keyword">val</span> hoge1 <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// エラー</span><br>    <span class="token keyword">val</span> hoge2 <span class="token operator">=</span> _<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// エラー</span><br>    <span class="token boolean">true</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre>
<p>主にイベントリスナーで、ラムダ式の「引数を使わない」ことを示すために、 C# では「引数名を <code>_</code> にする」という文化があります。<br>
が、あくまで文化でしかないので、変数 <code>_</code> が存在しているだけであり、引数が２個あったら両者に <code>_</code> は使えないし、関数内で <code>_</code> は変数として普通に使えてしまいます。</p>
<p>一方で Kotlin の <code>_</code> は「使用しない変数名」として特別視されており?、複数の引数に割り当てられるし、関数内で <code>_</code> を使うとエラーにしてくれます。</p>
<p>C# でラムダ式をネストせざるを得ないときに、まあまあな頻度で <code>_</code> を複数回使いたいなーと感じることがあるので、Kotlin の <code>_</code> は便利だなー、と思います。</p>
<h2 id="%E9%80%86%E3%81%AB-kotlin-%E3%81%AE%E3%80%8C%E3%81%93%E3%82%8C%E3%81%AF%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AB%E3%81%AF%E5%A5%BD%E3%81%8B%E3%82%93%E3%80%8D%E3%81%A8%E3%81%93%E3%82%8D">逆に Kotlin の「これは個人的には好かん」ところ <a class="direct-link" href="#%E9%80%86%E3%81%AB-kotlin-%E3%81%AE%E3%80%8C%E3%81%93%E3%82%8C%E3%81%AF%E5%80%8B%E4%BA%BA%E7%9A%84%E3%81%AB%E3%81%AF%E5%A5%BD%E3%81%8B%E3%82%93%E3%80%8D%E3%81%A8%E3%81%93%E3%82%8D">#</a></h2>
<h3 id="%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7-public">デフォルトで public <a class="direct-link" href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%A7-public">#</a></h3>
<p>API設計は、慎重派なんですよ。<br>
気持ちよさにかまけて非公開とすべきAPIに private を付け忘れそう。</p>
<h3 id="smart-cast">Smart cast <a class="direct-link" href="#smart-cast">#</a></h3>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">doWork</span><span class="token punctuation">(</span>card<span class="token operator">:</span>AddressCard<span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">val</span> name <span class="token operator">=</span> card<span class="token punctuation">.</span>name  <span class="token comment">// nullableだからエラー</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>card <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// null をチェックすれば…</span><br>    <span class="token keyword">val</span> name2 <span class="token operator">=</span> card<span class="token punctuation">.</span>name  <span class="token comment">// 大丈夫だ、nullの可能性は無い</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>まあ便利で使いもするんだけど、 <code>card?.let{ }</code> で代用できるし(これも Smart Cast だとコメントで教えてもらいました)。</p>
<p>C# でも <code>Nullable&lt;T&gt;</code> なら 「スコープ内は null でないことを保証できる」 <code>Let</code> 拡張関数が書けるので、参考までに載せときます。</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">R<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">Let</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">T<span class="token punctuation">?</span></span> self<span class="token punctuation">,</span> <span class="token class-name">Func<span class="token punctuation">&lt;</span>T<span class="token punctuation">,</span> R<span class="token punctuation">?</span><span class="token punctuation">></span></span> mapper<span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">struct</span></span> <span class="token keyword">where</span> <span class="token class-name">R</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">struct</span></span> <br>    <span class="token operator">=></span> <span class="token return-type class-name">self<span class="token punctuation">.</span>HasValue <span class="token punctuation">?</span></span> mapper<span class="token punctuation">.</span><span class="token function">Invoke</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>Value<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>R<span class="token punctuation">?</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">;</span><br><br><span class="token class-name"><span class="token keyword">int</span><span class="token punctuation">?</span></span> num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><br><span class="token class-name"><span class="token keyword">int</span></span> ret1 <span class="token operator">=</span> num<span class="token punctuation">?.</span><span class="token function">Let</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nonNullNum<span class="token punctuation">)</span> <span class="token operator">=></span> nonNullNum <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -> 6</span><br><br>num <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br><span class="token class-name"><span class="token keyword">int</span></span> ret2 <span class="token operator">=</span> num<span class="token punctuation">?.</span><span class="token function">Let</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> nonNullNum<span class="token punctuation">)</span> <span class="token operator">=></span> nonNullNum <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">??</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// -> -1</span></code></pre>
<h3 id="non-local-return">Non-local return <a class="direct-link" href="#non-local-return">#</a></h3>
<pre class="language-kotlin"><code class="language-kotlin"><span class="token keyword">fun</span> <span class="token function">upperJoin</span><span class="token punctuation">(</span>name<span class="token operator">:</span>String<span class="token punctuation">,</span> zip<span class="token operator">:</span>String<span class="token punctuation">)</span> <span class="token operator">:</span> String <span class="token punctuation">{</span><br>    <span class="token keyword">val</span> nameUpper <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> x<span class="token operator">-></span><br>        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token string">""</span>      <span class="token comment">// upperJoin を抜けちゃう！</span><br><span class="token comment">//          return@let ""  // この let {} スコープを抜けるだけ</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">val</span> zipUpper <span class="token operator">=</span> zip<span class="token punctuation">.</span><span class="token function">let</span> <span class="token punctuation">{</span> it<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token string">"<span class="token interpolation variable">$nameUpper</span>:<span class="token interpolation variable">$zipUpper</span>"</span><br><span class="token punctuation">}</span></code></pre>
<p>上のコードは <code>name</code> が空文字の場合、<code>zip</code> を無視して空文字を返してしまいます。<br>
いつかハマりそうで、オドオドしてます。</p>
<p>Smart-cast も Non-local return も、自分が知ってる言語にない機構に拒否反応を示してるだけですね。慣れたらガンガン使いそうです。</p>
<p>C# にしかない機能や、これから新たに追加される機能もあると思いますが、あくまで自分が使用する範囲で感じたこと、ということで。</p>
<p>C# の方ももちろん進化は続いていて、</p>
<ul>
<li><a href="https://blogs.msdn.microsoft.com/dotnet/2017/11/15/nullable-reference-types-in-csharp/">Introducing Nullable Reference Types in C# | .NET Blog</a></li>
</ul>
<p>に代表されるように、モダンと呼ばれる仕様も次々と取り込まれていく雰囲気が好きです。</p>


published at <time class="postlist-date" datetime="2017-12-06">06 Dec 2017</time>

tags: 

  <a href="/tags/Csharp/" class="post-tag">C#</a>
  <a href="/tags/Kotlin/" class="post-tag">Kotlin</a>

<hr>
<ul><li>Next: <a href="/blog/2017/12/06/0994ebe8e5c815823c97/">リストの中から、条件にマッチした最初のアイテムが何番目かを返すやつ</a></li><li>Previous: <a href="/blog/2017/12/05/58e589780ccea6fd5470/">RxJava の Observable と LiveData と ObservableField をいい感じで使おう</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2017/12/06/56149cfdf84004418d5d/ -->
  </body>
</html>
