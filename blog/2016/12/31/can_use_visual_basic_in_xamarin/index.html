<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Basic で Xamarin.Forms アプリ開発どこまでいける？</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>Visual Basic で Xamarin.Forms アプリ開発どこまでいける？</h1>

<p><a href="http://qiita.com/advent-calendar/2016/xamarin-welcome">[初心者さん・学生さん大歓迎！] Xamarin その2 Advent Calendar 2016</a> 25日目です。<br>
Xamarin アプリ開発で使用できる言語は、公式には C# と F# のみですが、初心者にやさしいとされる Visual <a href="http://Basic.NET">Basic.NET</a>(<a href="http://VB.NET">VB.NET</a>) を使って Xamarin（今回は Xamarin.Forms）アプリは開発できないのでしょうか？</p>
<!--more-->
<p>チャレンジしてみました。</p>
<h2 id="%E3%81%84%E3%81%8D%E3%81%AA%E3%82%8A%E7%B5%90%E8%AB%96">いきなり結論 <a class="direct-link" href="#%E3%81%84%E3%81%8D%E3%81%AA%E3%82%8A%E7%B5%90%E8%AB%96">#</a></h2>
<p>まあだいたい察しがつくので先に結論言っちゃいますけど、<a href="http://VB.NET">VB.NET</a> での Xamarin.Forms アプリ開発は、 <strong>「部分的に可能」</strong> です。</p>
<p>部分的に、というのは PCL で作れる箇所で、且つ Xamarin.Forms の XAML 以外です。</p>
<p>PCL は Xamarin でなく  .NET 標準のライブラリだから、.NET 系の言語ならなんでも作れるわけですね。</p>
<h2 id="%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AE-xamarin.forms-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AF%E3%80%81%E3%81%A9%E3%81%93%E3%81%BE%E3%81%A7-visual-basic-%E5%8C%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%EF%BC%9F">一般的な構成の Xamarin.Forms アプリは、どこまで Visual Basic 化できるか？ <a class="direct-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E3%81%AA%E6%A7%8B%E6%88%90%E3%81%AE-xamarin.forms-%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AF%E3%80%81%E3%81%A9%E3%81%93%E3%81%BE%E3%81%A7-visual-basic-%E5%8C%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%EF%BC%9F">#</a></h2>
<h3 id="not-xaml-%E3%81%AE%E5%A0%B4%E5%90%88">Not XAML の場合 <a class="direct-link" href="#not-xaml-%E3%81%AE%E5%A0%B4%E5%90%88">#</a></h3>
<p>Xamarin.Forms プロジェクトをテンプレートから作成すると、</p>
<ul>
<li>MyApp</li>
<li>MyApp.Droid</li>
<li>MyApp.iOS</li>
<li>MyApp.UWP</li>
</ul>
<p>の４つのプロジェクトがいずれも C# で作成されます。<br>
（この内、もともと MS の管轄である UWP は今回のネタからは除外します）</p>
<p>コアとなる MyApp プロジェクトは PCL なので、ここは Visual Basic が使えます。<br>
ちょっとやってみましょう。</p>
<p><img src="/img/posts/xamarinforms_with_vb_01.png" alt=""></p>
<p>を</p>
<p><img src="/img/posts/xamarinforms_with_vb_02.png" alt=""></p>
<p>こうします。</p>
<p>C# で適当な Xamarin.Forms プロジェクトを作成した後、追加 -&gt; 新しいプロジェクト で、 <strong>Visual Basic のポータブルクラスライブラリ</strong> を作成します。</p>
<p><img src="/img/posts/xamarinforms_with_vb_03.png" alt=""></p>
<p>なんかプロファイルを聞かれるので、 Xamarin.Android と Xamarin.iOS と UWP あたりを含ませます。</p>
<p><img src="/img/posts/xamarinforms_with_vb_04.png" alt=""></p>
<p><a href="http://VB.NET">VB.NET</a> の PCL に、nuget パッケージマネージャから「Xamarin.Forms」を追加します。</p>
<p><code>App.vb</code> クラスを追加し、以下のように書きます。</p>
<pre class="language-vbnet"><code class="language-vbnet"><span class="token keyword">Imports</span> Xamarin.Forms<br><br><span class="token keyword">Public</span> <span class="token keyword">Class</span> App<br>    <span class="token keyword">Inherits</span> Application<br><br>    <span class="token keyword">Private</span> <span class="token keyword">WithEvents</span> _button1 <span class="token keyword">As</span> Button<br><br>    <span class="token keyword">Sub</span> <span class="token keyword">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>        <span class="token keyword">Dim</span> layout <span class="token operator">=</span> <span class="token keyword">New</span> StackLayout<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">With</span> {<br>                 .VerticalOptions <span class="token operator">=</span> LayoutOptions.Center<br>        }<br><br>        _button1 <span class="token operator">=</span> <span class="token keyword">New</span> Button<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">With</span> {<br>            .<span class="token function">Text</span> <span class="token operator">=</span> <span class="token string">"Goto Second"</span><br>            }<br><br>        layout.Children.Add<span class="token punctuation">(</span><span class="token keyword">New</span> Label<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">With</span> {<br>            .HorizontalTextAlignment <span class="token operator">=</span> TextAlignment.Center<span class="token punctuation">,</span><br>            .<span class="token function">Text</span> <span class="token operator">=</span> <span class="token string">"Xamarin.Forms with Visual Basic!"</span><br>        }<span class="token punctuation">)</span><br>        layout.Children.Add<span class="token punctuation">(</span>_button1<span class="token punctuation">)</span><br><br>        <span class="token keyword">Dim</span> content <span class="token operator">=</span> <span class="token keyword">New</span> ContentPage<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">With</span> {<br>            .Title <span class="token operator">=</span> <span class="token string">"TryXFWithVB"</span><span class="token punctuation">,</span><br>            .Content <span class="token operator">=</span> layout<br>        }<br><br>        MainPage <span class="token operator">=</span> <span class="token keyword">New</span> NavigationPage<span class="token punctuation">(</span>content<span class="token punctuation">)</span><br><br>    <span class="token keyword">End</span> <span class="token keyword">Sub</span><br><br>    <span class="token keyword">Private</span> <span class="token keyword">Sub</span> Button1_Clicked<span class="token punctuation">(</span>sender <span class="token keyword">As</span> <span class="token keyword">Object</span><span class="token punctuation">,</span> args <span class="token keyword">As</span> EventArgs<span class="token punctuation">)</span> <span class="token keyword">Handles</span> _button1.Clicked<br>        <span class="token comment">''次のページに遷移する処理を書く</span><br>    <span class="token keyword">End</span> <span class="token keyword">Sub</span><br><span class="token keyword">End</span> <span class="token keyword">Class</span></code></pre>
<p>最後に、 Droid と iOS プロジェクトが参照するプロジェクトを、C# の PCL プロジェクトから <a href="http://VB.NET">VB.NET</a> の PCL プロジェクトに切り替えます。</p>
<p>で、実行すると、こうなります（iOS の場合）。</p>
<p><img src="/img/posts/xamarinforms_with_vb_05.png" alt=""></p>
<p>ほら <a href="http://VB.NET">VB.NET</a> で Xamarin.Forms 、できました。C# 側の PCL プロジェクトは削除してしまって問題ないです。</p>
<h3 id="xaml-%E3%81%AE%E5%A0%B4%E5%90%88">XAML の場合 <a class="direct-link" href="#xaml-%E3%81%AE%E5%A0%B4%E5%90%88">#</a></h3>
<p>コードで画面を書くのはできましたが、Xamarin.Forms XAML は使えるのでしょうか？<br>
使えなさそう……使えませんでしたー。</p>
<p>C# の Xamarin.Forms XAML や、<a href="http://VB.NET">VB.NET</a> の WPF の XAML プロジェクトを見て、見よう見まねでプロジェクトファイル(<code>.vbproj</code>) を、書いてみましたが、「XAML とコードビハインド」として認識されず…。</p>
<p><img src="/img/posts/xamarinforms_with_vb_06.png" alt=""></p>
<h2 id="prism.forms-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92-vb.net-%E5%8C%96%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">Prism.Forms プロジェクトを <a href="http://VB.NET">VB.NET</a> 化してみる <a class="direct-link" href="#prism.forms-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92-vb.net-%E5%8C%96%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">#</a></h2>
<p>画面を XAML で書きたいとなったら、<a href="http://VB.NET">VB.NET</a> をあきらめるしかありません。<br>
が、コードビハインドに１行も書かないマン＆ウーマンだったら、Xamarin.Forms のプロジェクトが C# でも問題ないはず。なぜなら ViewModel や Model のプロジェクトを切り離して、そっちを <a href="http://VB.NET">VB.NET</a> にすれば良いのだから！</p>
<p>試しに Prism.Forms のプロジェクトを <a href="http://VB.NET">VB.NET</a> 化してみましょう。<br>
ここでは @Nuits さんの</p>
<ul>
<li><a href="https://github.com/jxug/PrismAndMoqHansOn/blob/master/docs/01.HandsOn-Overview.md">PrismAndMoqHansOn/01.HandsOn-Overview.md at master · jxug/PrismAndMoqHansOn</a></li>
<li><a href="http://www.nuits.jp/entry/2016/11/06/202916">Prism and Moqハンズオンのドキュメントを大幅に加筆修正しました - nuits.jp blog</a></li>
</ul>
<p>を題材にさせてもらいます。</p>
<h3 id="viewmodel%E3%80%81model-%E3%82%92-vb.net-%E5%8C%96%E3%81%99%E3%82%8B">ViewModel、Model を <a href="http://VB.NET">VB.NET</a> 化する <a class="direct-link" href="#viewmodel%E3%80%81model-%E3%82%92-vb.net-%E5%8C%96%E3%81%99%E3%82%8B">#</a></h3>
<p>このハンズオンのプロジェクトは、</p>
<p><img src="/img/posts/xamarinforms_with_vb_07.png" alt=""></p>
<p>のようになっているので、ViewModels と Models を <a href="http://VB.NET">VB.NET</a> のプロジェクトに追い出してこう</p>
<p><img src="/img/posts/xamarinforms_with_vb_08.png" alt=""></p>
<p>します。</p>
<p>コード長いんで、 github に上げました。</p>
<ul>
<li><a href="https://github.com/amay077/PrismHandsOnVB">amay077/PrismHandsOnVB</a></li>
</ul>
<p><a href="https://github.com/amay077/PrismHandsOnVB/blob/master/TextSpeaker/TextSpeakerCoreVB/ViewModels/BatteryPageViewModel.vb"><code>BatteryPageViewModel.vb</code></a> とか見ると分かるんですけど、 Xamarin.Forms の MVVM も、Prism.Forms も、ちゃんと <a href="http://VB.NET">VB.NET</a> でも動くんですよ（あたりまえだけど）</p>
<p>Prism.Forms で、View とは別アセンブリにある ViewModel を <code>AutoWireViewModel</code> で見つかるようにするために、同じく @Nuits さんの、</p>
<ul>
<li><a href="https://gist.github.com/nuitsjp/d3e3d819fb68e31b884800caa94a56bc">PrismでViewとViewModelを別アセンブリにする場合のコードサンプル</a></li>
</ul>
<p>を <a href="https://github.com/amay077/PrismHandsOnVB/blob/master/TextSpeaker/TextSpeaker/App.cs#L47">適用してます</a> 。</p>
<p>これで、ViewModel とビジネスロジックは <a href="http://VB.NET">VB.NET</a> で記述することができるようになりました。</p>
<h3 id="%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E5%9B%BA%E6%9C%89%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92-vb.net-%E5%8C%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%EF%BC%9F">プラットフォーム固有の処理を <a href="http://VB.NET">VB.NET</a> 化できるか？ <a class="direct-link" href="#%E3%83%97%E3%83%A9%E3%83%83%E3%83%88%E3%83%95%E3%82%A9%E3%83%BC%E3%83%A0%E5%9B%BA%E6%9C%89%E3%81%AE%E5%87%A6%E7%90%86%E3%82%92-vb.net-%E5%8C%96%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%8B%EF%BC%9F">#</a></h3>
<p>どうせなら、TextSpeaker.Droid/iOS で C# で行っている「ITextSpeaker の実装」も、<a href="http://VB.NET">VB.NET</a> プロジェクトに追い出して、こう</p>
<p><img src="/img/posts/xamarinforms_with_vb_09.png" alt=""></p>
<p>できないかなー、とトライしてみたのですが、できませんでした。</p>
<p>理由は、 「Xamarin.iOS/Android をサポートするクラスライブラリを <a href="http://VB.NET">VB.NET</a> で作成できない事」です。Xamarin.iOS/Android はともに Monoランタイムを基盤としますが、これを基盤とする <a href="http://VB.NET">VB.NET</a> のクラスライブラリを作成することができませんでした（少なくとも Visual Studio 2015 では）。</p>
<ul>
<li><a href="http://www.mono-project.com/docs/about-mono/languages/visualbasic/">Visual Basic support ｜ Mono</a></li>
<li><a href="https://karuakun.wordpress.com/2011/12/19/mono-develop%E3%81%A7vb%E3%81%AE%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%92%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%AB%E3%81%99%E3%82%8B%E3%80%82/">Mono DevelopでVBのソースをコンパイルする。 ｜ かるあのメモ on WordPress</a></li>
</ul>
<p>この辺を見ると <code>vbnc</code> ってコンパイラでできそう？いや Xamarin.Android/iOS はそれに対応してないからダメ？とかよくわかりません。</p>
<p>初心者向けの Visual Basic を使うのにトリッキーなことをするのも本末転倒なので深掘りは辞めておきます。</p>
<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ <a class="direct-link" href="#%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p>というわけでまとめ。</p>
<p>Visual Basic を使って Xamarin.Forms アプリの開発は、</p>
<ul>
<li><strong>XAML を使わない Xamarin.Forms アプリ開発</strong></li>
<li><strong>ViewModel とビジネスロジック</strong></li>
</ul>
<p>は可能です（特に後者を &quot;Xamarin の&quot; と呼んでよいかはお任せします）。</p>
<p>逆に Visual Basic では不可能なのは、</p>
<ul>
<li>Xamarin.Forms の XAML の使用</li>
<li>Xamarin.Android, Xamarin.iOS の使用</li>
</ul>
<p>です。</p>
<p>CustomRenderer、Effects などプラットフォーム固有の処理は C#/F# で書くしかありません。</p>
<p>Visual Basic エンジニアと分業するなら、彼らはモバイル系のAPIに関与できないので、逆に分かりやすいかも知れません。</p>
<p>半分ネタのつもりだったけど、VB要員も活かせるという意味では、ありかも知れませんね。</p>
<p>とここまで書いて、</p>
<ul>
<li><a href="https://developer.xamarin.com/guides/cross-platform/application_fundamentals/pcl/portable_visual_basic_net/xamarin-forms/">Xamarin.Forms using Visual Basic.NET - Xamarin</a></li>
<li><a href="http://ytabuchi.hatenablog.com/entry/2015/09/09/173455">【朗報？】Visual Basic ユーザーも Xamarin.Forms でモバイル開発者になれます！ - Xamarin 日本語情報</a></li>
</ul>
<p>と丸かぶりだったことに気づく（しかも 2015年9月の情報）！<br>
まあ今でも変わらないよ、ということで。</p>


published at <time class="postlist-date" datetime="2016-12-31">31 Dec 2016</time>

tags: 

  <a href="/tags/Xamarin/" class="post-tag">Xamarin</a>
  <a href="/tags/VisualBasic/" class="post-tag">VisualBasic</a>
  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/iOS/" class="post-tag">iOS</a>

<hr>
<ul><li>Next: <a href="/blog/2016/12/31/notice_for_creating_ui_library_for_xamarin_forms/">Xamarin.Forms 向けのUIライブラリを作る時の注意点</a></li><li>Previous: <a href="/blog/2016/12/27/making_picker_control_for_xamarin_forms/">Xamarin.Forms 向けのピッカーコントロールを作った</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2016/12/31/can_use_visual_basic_in_xamarin/ -->
  </body>
</html>
