<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everything is a stream, ViewModel is 何？</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>Everything is a stream, ViewModel is 何？</h1>

<p><a href="http://qiita.com/advent-calendar/2016/rxjava">RxJava Advent Calendar 2016</a> 13日目 です。<br>
RxJava と Android の DataBinding と MVVM についての話をします。</p>
<!--more-->
<h2 id="everything-is-a-stream">Everything is a stream <a class="direct-link" href="#everything-is-a-stream">#</a></h2>
<p><img src="/img/posts/everythis_is_a_stream_what_is_viewmodel_01.jpg" alt=""></p>
<p>via <a href="http://slides.com/robwormald/everything-is-a-stream#/">Rob Wormald</a></p>
<p>いいコトバですね。</p>
<p>Android アプリ開発では、事実上 stream is an (RxJava の) <code>Observable&lt;T&gt;</code>、<br>
つまり<br>
<strong>Everything is an <code>Observable&lt;T&gt;</code></strong> と言ってもいいでしょう。</p>
<p>ところで、 Android アプリ開発でも DataBinding の登場以来、MVVM パターンの話題が増えてきました。</p>
<p>Everything is a <code>Observable&lt;T&gt;</code>、では ViewModel はどうでしょう？</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">{</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> bio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObservableField</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <br><span class="token punctuation">}</span></code></pre>
<p><code>ObservableField&lt;T&gt;</code> … <code>Observable&lt;T&gt;</code> じゃない！（<code>BaseObservable</code> でも同じね）</p>
<p>これの何がイヤかというと、Model から流れてくる値を View に表示してやるために、ViewModel で subscribe しないといけない所です。</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token class-name">MainViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// めんどい</span><br>        _someModel<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">-></span> <span class="token punctuation">{</span><br>            name <span class="token operator">=</span> x<span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>RxJava の <code>Observable&lt;T&gt;</code> をそのまま View にバインドできたらどれだけ楽だろうか、それを実現してくれるのが <strong>rx-property-android</strong> というライブラリです。</p>
<ul>
<li><a href="https://github.com/k-kagurazaka/rx-property-android">k-kagurazaka/rx-property-android: Bindable and observable property for Android Data Binding</a></li>
<li><a href="http://qiita.com/k-kagurazaka@github/items/3fc1fc19ea608cac9913">RxPropertyでRxJavaとAndroid Data Bindingを連携する - Qiita</a> ←作者: @k-kagurazaka@github さんによる解説</li>
</ul>
<h2 id="rx-property-android-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">rx-property-android を使ってみる <a class="direct-link" href="#rx-property-android-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">#</a></h2>
<p>「UserID を指定して、GitHub のユーザー情報を取得する」という単純なサンプルを作ってみます。</p>
<p>こんなのです。</p>
<p><img src="/img/posts/everythis_is_a_stream_what_is_viewmodel_02.gif" alt=""></p>
<p>実装の説明の前に、MVVM に関するこのスライドを見てください。</p>
<ul>
<li><a href="https://speakerdeck.com/shinpeim/vue-dot-jsdeshi-xian-surumvvmpatan-fluxakitekutiyatofalseju-li">Vue.jsで実現するMVVMパターン Fluxアーキテクチャとの距離 // Speaker Deck</a></li>
<li><a href="http://techblog.reraku.co.jp/entry/2016/12/13/080000">実況中継シリーズ Vue.jsで実現するMVVMパターン Fluxアーキテクチャとの距離 - Re.Ra.Ku アドベントカレンダー day 13 - Re.Ra.Ku tech blog</a></li>
</ul>
<p>とっても勉強になります。</p>
<ul>
<li><em><em>「注意深く設計された MV</em> は単一データフローになる」</em>*</li>
<li><strong>「ModelについてViewModelが行うことは、イベントに対する反応と戻り値のないメソッドの呼び出ししかない」</strong> via <a href="http://ugaya40.hateblo.jp/entry/model-mistake">MVVMのModelにまつわる誤解</a></li>
</ul>
<p>では実装を説明します、まずモデル。</p>
<p>ロジック自体は本題ではないので、公開インターフェースだけ載せます。</p>
<pre class="language-java"><code class="language-java"><span class="token comment">// GutHubModel.java</span><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GitHubModel</span> <span class="token punctuation">{</span><br>    <span class="token comment">// 外部に公開する Hot な Observable</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">Observable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">></span></span> user <span class="token operator">=</span> _user<span class="token punctuation">;</span><br><br>    <span class="token comment">// 指定した UserID の GitHub ユーザー情報を得る</span><br>    <span class="token comment">// Model だから戻り値の無いメソッドだよ</span><br>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>       <span class="token comment">/* ごにょごにょやって user の onNext を呼び出す */</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>「イベントに対する反応」が <code>Observable&lt;User&gt; user</code> で、<br>
「戻り値のないメソッド」が <code>void getUser(String user)</code> ですね。</p>
<p>メソッドが呼ばれると、GitHub API で通信して User を得、<code>user</code> の <code>onNext</code> を呼び出して、変更を通知します。</p>
<p>次、本題の ViewModel です。</p>
<pre class="language-java"><code class="language-java"><span class="token comment">// MainViewModel.java</span><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">{</span><br>    <span class="token comment">// View(EditText) と TwoWay Binding する RxProperty</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> userId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token comment">// ボタンをおした時に実行されるコマンド(＝ボタンを押した時に onNext が呼ばれる Observable)</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">RxCommand</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">></span></span> getUserCommand<span class="token punctuation">;</span><br><br>    <span class="token comment">// Model -> View DataBinding 用の RxProperty（name.value で DataBinding できる）</span><br>    <span class="token comment">// OneWay Binding だから ReadOnlyRxProperty の方が望ましい</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> name<span class="token punctuation">;</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> location<span class="token punctuation">;</span><br>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> bio<span class="token punctuation">;</span><br><br>    <span class="token comment">// GitHub からユーザー情報を得る Model. DIしようね</span><br>    <span class="token keyword">final</span> <span class="token class-name">GitHubModel</span> _gitHubModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GitHubModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>    <span class="token keyword">public</span> <span class="token class-name">MainViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token comment">// Model -> ViewModel -> View のデータの流れ道を作っておきましょう</span><br>        <span class="token comment">// GitHubModel の user が変更されたら、name/location/bio にそれぞれデータを流すよ</span><br>        name <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>_gitHubModel<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        location <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>_gitHubModel<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        bio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RxProperty</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>_gitHubModel<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>user <span class="token operator">-></span> user<span class="token punctuation">.</span><span class="token function">getBio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><br>        <span class="token comment">// ユーザー取得コマンドは userID が空でない時のみ使用可能です</span><br>        getUserCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RxCommand</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>userId<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>x <span class="token operator">-></span> <span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token comment">// ユーザー取得が実行されたら GitHubModel の getUser を呼ぶよ</span><br>        getUserCommand<span class="token punctuation">.</span><span class="token function">asObservable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>x <span class="token operator">-></span> <span class="token punctuation">{</span><br>            _gitHubModel<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>userId<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>rx-property-android を使用した結果、</p>
<ul>
<li><code>ObservableField&lt;T&gt;</code> が <code>RxProperty&lt;T&gt;</code> に</li>
<li><code>ボタンのイベントハンドラ</code> が <code>RxCommand</code> に</li>
</ul>
<p>置き換わっています。<br>
そしてこれらは、その名が示すとおり全て <code>Observable&lt;T&gt;</code> と連携しています。</p>
<p>例えば <code>RxProperty&lt;String&gt; name</code> は、 <code>_githubModel.user</code> を map オペレータで <code>getName()</code> に変換しています。他の２つも同様です。</p>
<p><code>RxCommand getUserCommand</code> も <code>Observable&lt;T&gt;</code> です。<br>
これは、「コマンドが実行されたら onNext() が呼び出される」という Observable です(<a href="http://qiita.com/Reyurnible/items/b2888d2d1d13110d2250">RxBinding</a> のようなイメージ)。</p>
<p>このように、全て <code>Observable&lt;T&gt;</code> にすることができました。<br>
イミュータブルなフィールドとコンストラクタで「定義」するだけ、美しい・・・。</p>
<p>Everything is an <code>Observable&lt;T&gt;</code>, <strong>ViewModel is also <code>Observable&lt;T&gt;</code></strong></p>
<p>さて、ではこの <code>RxProperty&lt;T&gt;</code> と <code>RxCommand</code> を View(xml) でバインドします。</p>
<pre class="language-xml"><code class="language-xml">// activity_main.xml<br><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">xmlns:</span>tools</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/tools<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">tools:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>net.amay077.rxretrofitsample.MainActivity<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>variable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewModel<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>net.amay077.rxretrofitsample.viewmodels.MainViewModel<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data</span><span class="token punctuation">></span></span><br>    <br>    (中略)<br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span> <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@={viewModel.userId.value}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Button</span><br>                <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@+id/buttonGetUser<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Get User<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">app:</span>rxCommandOnClick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{viewModel.getUserCommand}<span class="token punctuation">"</span></span><br>                <span class="token punctuation">/></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span> <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{viewModel.name.value}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span> <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{viewModel.location.value}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span> <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>                <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>@{viewModel.bio.value}<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>    (中略)<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layout</span><span class="token punctuation">></span></span></code></pre>
<p>RxProperty のバインドは <code>&lt;プロパティ名&gt;.value</code> とします。 .value をよく忘れるので注意が必要です。<br>
RxCommand は <code>app:rxCommandOnClick</code> を使ってバインドします。</p>
<h2 id="%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">ソースコード <a class="direct-link" href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">#</a></h2>
<p>完成形のソースコードは、</p>
<ul>
<li><a href="https://github.com/amay077/RxPropertyRetrofitSample">amay077/RxPropertyRetrofitSample</a></li>
</ul>
<p>にあります。</p>
<h2 id="%E3%81%BE%E3%81%A8%E3%82%81">まとめ <a class="direct-link" href="#%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p><a href="https://github.com/k-kagurazaka/rx-property-android">rx-property-android</a> を使うと DataBinding と <code>Observable&lt;T&gt;</code> の連携ができます。</p>
<p>全てが <code>Observable&lt;T&gt;</code> なら、</p>
<p><strong>「左手はそえるだけ、ViewModel はつなぐだけ」</strong></p>
<p>流れるような DataBinding + MVVM ライフを。</p>
<h3 id="%E3%81%8A%E3%81%BE%E3%81%91">おまけ <a class="direct-link" href="#%E3%81%8A%E3%81%BE%E3%81%91">#</a></h3>
<p>rx-property-android は、 .NET の <a href="https://github.com/runceel/ReactiveProperty">ReactiveProperty</a> というライブラリを Android 向けに移植してくださっているものです。</p>
<p>ReactiveProperty は .NETアプリケーション他、 Xamarin によるモバイルアプリケーションでも多数の事例があります(<a href="https://twitter.com/ytabuchi/status/806706768042606592">NHK紅白アプリ</a>とかね)。</p>
<p>私は <a href="https://droidkaigi.github.io/2017/">DroidKaigi 2017</a> で Xamarin.Android について話しますが、ReactiveProperty を使った Android/iOS 共通な ViewModel の話も少ししたいなーと思っています、ご興味あれば是非。</p>


published at <time class="postlist-date" datetime="2016-12-13">13 Dec 2016</time>

tags: 

  <a href="/tags/RxJava/" class="post-tag">RxJava</a>
  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/DataBinding/" class="post-tag">DataBinding</a>
  <a href="/tags/MVVM/" class="post-tag">MVVM</a>

<hr>
<ul><li>Next: <a href="/blog/2016/12/20/best_practice_for_secret_key_management_in_xamarin_project/">Xamarin プロジェクトにおける API key など秘密情報管理のベスト？プラクティス</a></li><li>Previous: <a href="/blog/2016/12/10/copy_file_to_shared_folder_with_password/">VB.NET でパスワード付き共有フォルダにファイルをコピーする</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2016/12/13/eveything_is_a_stream_what_is_a_viewmodel/ -->
  </body>
</html>
