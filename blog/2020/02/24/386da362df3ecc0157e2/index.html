<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapBox GL JS でラベル付きマーカー</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>MapBox GL JS でラベル付きマーカー</h1>

<p>MapBox GL のサンプルにカスタムマーカーがあるので、それを参考に「ラベル付きのマーカー」を実現してみた。</p>
<!--more-->
<p><img src="https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/8227/6332001c-8d5c-f095-235e-672f1ccf4bd7.png" alt="image.png"></p>
<p>動作するサンプルはこちら。</p>
<ul>
<li><a href="https://jsfiddle.net/amay077/vn3741o6/15/">MapBox GL JS Marker with label / JSFiddle - Code Playground</a></li>
</ul>
<h2 id="%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">ソースコード <a class="direct-link" href="#%E3%82%BD%E3%83%BC%E3%82%B9%E3%82%B3%E3%83%BC%E3%83%89">#</a></h2>
<p><strong>index.html</strong></p>
<pre class="language-html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>utf-8<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>viewport<span class="token punctuation">'</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>initial-scale=1,maximum-scale=1,user-scalable=no<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://fonts.googleapis.com/css?family=Open+Sans<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://api.tiles.mapbox.com/mapbox-gl-js/v1.8.0/mapbox-gl.js<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>https://api.tiles.mapbox.com/mapbox-gl-js/v1.8.0/mapbox-gl.css<span class="token punctuation">'</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>stylesheet<span class="token punctuation">'</span></span> <span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/css<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.css<span class="token punctuation">"</span></span> <span class="token attr-name">media</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>screen<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css"><br>  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>map<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>marker<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>marker-container<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>marker-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>marker-icon<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://img.icons8.com/ios-filled/40/0000FF/marker.png<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./index.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p><strong>index.css</strong></p>
<pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span><br>  <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">#map</span> <span class="token punctuation">{</span><br>  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span><br>  <span class="token property">top</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token property">bottom</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br>  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.marker-container</span> <span class="token punctuation">{</span><br>  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <br>  <span class="token property">flex-direction</span><span class="token punctuation">:</span> column<span class="token punctuation">;</span> <br>  <span class="token property">align-items</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span> <br>  <span class="token property">cursor</span><span class="token punctuation">:</span> pointer<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.marker-title</span> <span class="token punctuation">{</span><br>  <span class="token property">max-width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span><br>  <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span><br>  <span class="token property">text-overflow</span><span class="token punctuation">:</span> ellipsis<span class="token punctuation">;</span><br>  <span class="token property">white-space</span><span class="token punctuation">:</span> nowrap<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.marker-icon</span> <span class="token punctuation">{</span><br>  <span class="token property">height</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span> <br>  <span class="token property">width</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <br>  <span class="token property">background-size</span><span class="token punctuation">:</span> cover<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.mapboxgl-popup</span> <span class="token punctuation">{</span><br>  <span class="token property">max-width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.mapboxgl-popup-content</span> <span class="token punctuation">{</span><br>  <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">'Open Sans'</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>index.js</strong></p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> geojson <span class="token operator">=</span> <span class="token punctuation">{</span><br>  type<span class="token operator">:</span> <span class="token string">'FeatureCollection'</span><span class="token punctuation">,</span><br>  features<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>    type<span class="token operator">:</span> <span class="token string">'Feature'</span><span class="token punctuation">,</span><br>    geometry<span class="token operator">:</span> <span class="token punctuation">{</span><br>    type<span class="token operator">:</span> <span class="token string">'Point'</span><span class="token punctuation">,</span><br>      coordinates<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">77.032</span><span class="token punctuation">,</span> <span class="token number">38.913</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    properties<span class="token operator">:</span> <span class="token punctuation">{</span><br>      title<span class="token operator">:</span> <span class="token string">'Mapbox'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token string">'Washington, D.C.'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">{</span><br>    type<span class="token operator">:</span> <span class="token string">'Feature'</span><span class="token punctuation">,</span><br>    geometry<span class="token operator">:</span> <span class="token punctuation">{</span><br>      type<span class="token operator">:</span> <span class="token string">'Point'</span><span class="token punctuation">,</span><br>      coordinates<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">122.414</span><span class="token punctuation">,</span> <span class="token number">37.776</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    properties<span class="token operator">:</span> <span class="token punctuation">{</span><br>      title<span class="token operator">:</span> <span class="token string">'Mapbox'</span><span class="token punctuation">,</span><br>      description<span class="token operator">:</span> <span class="token string">'San Francisco, California'</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">]</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mapboxgl<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  container<span class="token operator">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span><br>  center<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">96</span><span class="token punctuation">,</span> <span class="token number">37.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  zoom<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span><br>  style<span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token string">"version"</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span><br>    <span class="token string">"sources"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token string">"OSM"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"raster"</span><span class="token punctuation">,</span><br>        <span class="token string">"tiles"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'http://a.tile.openstreetmap.org/{z}/{x}/{y}.png'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token string">"tileSize"</span><span class="token operator">:</span> <span class="token number">256</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token string">"layers"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>      <span class="token string">"id"</span><span class="token operator">:</span> <span class="token string">"OSM"</span><span class="token punctuation">,</span><br>      <span class="token string">"type"</span><span class="token operator">:</span> <span class="token string">"raster"</span><span class="token punctuation">,</span><br>      <span class="token string">"source"</span><span class="token operator">:</span> <span class="token string">"OSM"</span><br>    <span class="token punctuation">}</span><span class="token punctuation">]</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>geojson<span class="token punctuation">.</span>features<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">marker</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br><br>  <span class="token comment">// Create element for marker from template</span><br>  <span class="token keyword">const</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> clone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">importNode</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> el <span class="token operator">=</span> clone<span class="token punctuation">.</span>firstElementChild<span class="token punctuation">;</span><br>  <br>  clone<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> marker<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>description<span class="token punctuation">;</span><br>  <br>  <span class="token keyword">new</span> <span class="token class-name">mapboxgl<span class="token punctuation">.</span>Marker</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> <span class="token punctuation">{</span> anchor<span class="token operator">:</span> <span class="token string">'bottom'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">setLngLat</span><span class="token punctuation">(</span>marker<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>coordinates<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">setPopup</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">mapboxgl<span class="token punctuation">.</span>Popup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> offset<span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span> anchor<span class="token operator">:</span> <span class="token string">'bottom'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// add popups</span><br>    <span class="token punctuation">.</span><span class="token function">setHTML</span><span class="token punctuation">(</span><span class="token string">'&lt;h3>'</span> <span class="token operator">+</span> marker<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>title <span class="token operator">+</span> <span class="token string">'&lt;/h3>&lt;p>'</span> <span class="token operator">+</span> marker<span class="token punctuation">.</span>properties<span class="token punctuation">.</span>description <span class="token operator">+</span> <span class="token string">'&lt;/p>'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<ol>
<li>マーカーとして使用する HTML 要素を <code>template</code> タグで用意しておきます。</li>
<li>マーカーごとに <code>template</code> から要素を生成(<code>importNode</code> で複製しないと同じ要素が使い回されるので注意)してラベルを設定、その要素から MapBox の Marker を生成します。</li>
</ol>
<p>※地図を OpenStreetMaps にしているのは、MapBox の地図を表示するには AccessToken を設定する必要があるためです。</p>
<h2 id="%E5%8F%82%E8%80%83">参考 <a class="direct-link" href="#%E5%8F%82%E8%80%83">#</a></h2>
<ul>
<li><a href="https://docs.mapbox.com/help/tutorials/custom-markers-gl-js/">Add custom markers in Mapbox GL JS | Help | Mapbox</a></li>
<li><a href="http://hinoshita.hatenadiary.com/entry/2018/07/31/163225">mapbox-gl.jsでOSMを表示 - hinosita's diary</a></li>
</ul>


published at <time class="postlist-date" datetime="2020-02-24">24 Feb 2020</time>

tags: 

  <a href="/tags/JavaScript/" class="post-tag">JavaScript</a>
  <a href="/tags/geo/" class="post-tag">geo</a>
  <a href="/tags/mapbox/" class="post-tag">mapbox</a>
  <a href="/tags/mapbox-gl-js/" class="post-tag">mapbox-gl-js</a>
  <a href="/tags/map/" class="post-tag">map</a>

<hr>
<ul><li>Next: <a href="/blog/2020/03/05/81bbb556b9d6063370fb/">Serverless Framework で AWS Lambda と API Gateway をデプロイする</a></li><li>Previous: <a href="/blog/2020/02/15/d090838479eab90f4abb/">Debugger for Chrome の launch で Google  アカウントでのログインができなくなった件</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2020/02/24/386da362df3ecc0157e2/ -->
  </body>
</html>
