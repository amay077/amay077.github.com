<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FOSS4G 開発者の為の、図形演算ライブラリガイド</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>FOSS4G 開発者の為の、図形演算ライブラリガイド</h1>

<p>これは <a href="http://atnd.org/events/45511">FOSS4G Advent Calendar 2013</a> と、<a href="http://qiita.com/advent-calendar/2013/xamarin">Xamarin Advent Calendar 2013</a>  のクロスポストになります。</p>
<p>地図に関するシステムを作っていますと、必ず必要になるのが図形と図形の演算です。(結合 とか、分割とか、そういうの）</p>
<!--more-->
<p>私にとっては自分で実装するのは、とても大変な部類なのですが、今日では、いろいろなオープンソースライブラリが存在していて、それを使わせて頂いています。</p>
<p>今日は、それらの紹介をします。</p>
<h2 id="%E5%9B%B3%E5%BD%A2%E6%BC%94%E7%AE%97%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E9%81%94">図形演算ライブラリ達 <a class="direct-link" href="#%E5%9B%B3%E5%BD%A2%E6%BC%94%E7%AE%97%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E9%81%94">#</a></h2>
<h3 id="jts-topology-suite-(jts)">JTS Topology Suite (JTS) <a class="direct-link" href="#jts-topology-suite-(jts)">#</a></h3>
<ul>
<li><a href="http://sourceforge.net/projects/jts-topo-suite/">http://sourceforge.net/projects/jts-topo-suite/</a></li>
<li>言語：Java</li>
<li>ライセンス：LGPL</li>
</ul>
<p>これがなければ死んでいた案件多し。いろいろな言語に移植され、事実上標準のライブラリ。LGPL ということだけが要注意であり少し残念。</p>
<h3 id="geos">GEOS <a class="direct-link" href="#geos">#</a></h3>
<ul>
<li><a href="http://trac.osgeo.org/geos/">http://trac.osgeo.org/geos/</a></li>
<li>言語：C++</li>
<li>ライセンス：LGPL</li>
</ul>
<p>JTS を C++ に移植したライブラリ。なので機能、ライセンスともに JTS とほとんど一緒。osgeo のツールをビルドする時に出てくること多い。</p>
<h3 id="net-topology-suite-(nts)">Net Topology Suite (NTS) <a class="direct-link" href="#net-topology-suite-(nts)">#</a></h3>
<ul>
<li><a href="https://code.google.com/p/nettopologysuite/">https://code.google.com/p/nettopologysuite/</a></li>
<li>言語：C#</li>
<li>ライセンス：LGPL</li>
</ul>
<p>JTS を .NET に移植したライブラリ。最初見た頃は、Not Implemented  な機能が多かったけど、だいぶ揃ってきたのかな。</p>
<h3 id="esri-geometry-api-for-java">Esri Geometry API for Java <a class="direct-link" href="#esri-geometry-api-for-java">#</a></h3>
<ul>
<li><a href="https://github.com/Esri/geometry-api-java">https://github.com/Esri/geometry-api-java</a></li>
<li>言語：Java</li>
<li>ライセンス：Apache 2.0</li>
</ul>
<p>この間の FOSS4GJ 2013 Tokyo で教えてもらった、Yet Another 図形演算ライブラリ。GIS の世界シェアトップである ESRI社がオープンソースで公開しています。だから品質は折り紙つき（のハズだ）。Apache ライセンスなのも嬉しい。</p>
<h3 id="clipper">Clipper <a class="direct-link" href="#clipper">#</a></h3>
<ul>
<li><a href="http://www.angusj.com/delphi/clipper.php">http://www.angusj.com/delphi/clipper.php</a></li>
<li>言語：Delphi、C++、C#、Python、Perl、Ruby、Haskell</li>
<li>ライセンス：Boost Software License</li>
</ul>
<p>名前の通り Clip(つまり AND(Intersection)演算)と Offset(Buffer の片側だけ)に特化したライブラリ。</p>
<h3 id="boost%3Ageometry">Boost:Geometry <a class="direct-link" href="#boost%3Ageometry">#</a></h3>
<ul>
<li><a href="http://www.boost.org/doc/libs/1_55_0/libs/geometry/doc/html/index.html">http://www.boost.org/doc/libs/1_55_0/libs/geometry/doc/html/index.html</a></li>
<li>言語：C++</li>
<li>ライセンス：Boost Software License</li>
</ul>
<p>そういえば、C++ の拡張ライブラリである Boost にも Geometry が入ったのでしたね。Screenshot がなかなか圧巻です。</p>
<h3 id="dotspatial">DotSpatial <a class="direct-link" href="#dotspatial">#</a></h3>
<ul>
<li><a href="http://dotspatial.codeplex.com/">http://dotspatial.codeplex.com/</a></li>
<li>言語：C#</li>
<li>ライセンス：LGPL</li>
</ul>
<p>ライブラリというよりはアプリケーションなのかな？ソースコードの中に <code>DotSpatial.Topology</code> などが見えます。</p>
<h3 id="jsts-topology-suite">JSTS Topology Suite <a class="direct-link" href="#jsts-topology-suite">#</a></h3>
<ul>
<li><a href="https://github.com/bjornharrtell/jsts">https://github.com/bjornharrtell/jsts</a></li>
<li>言語：JavaScript</li>
<li>ライセンス：LGPL</li>
</ul>
<p>探してみたらやっぱりあった JTS の JavaScript への移植版。ライセンスは(ry</p>
<h3 id="geoscript">GeoScript <a class="direct-link" href="#geoscript">#</a></h3>
<ul>
<li><a href="http://geoscript.org/">http://geoscript.org/</a></li>
<li>言語：JavaScript</li>
<li>ライセンス：MIT</li>
</ul>
<p>JavaScript製のライブラリ。最近は D3.js による視覚表現が流行ってきたので、内部ではこのようなライブラリが使われているのでしょうか。</p>
<h2 id="%E8%A9%A6%E3%81%97%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">試しに使ってみよう <a class="direct-link" href="#%E8%A9%A6%E3%81%97%E3%81%AB%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%88%E3%81%86">#</a></h2>
<p>Xamarin Advent Calendar と絡めるために無理やり Xamarin Studio で、という事は必然的に Net Topology Suite を使ってみます。</p>
<p>Xamarin Studio は、Android/iOS アプリを作るためだけじゃなくて、コンソールアプリとかも作ることができますよ、と言いたいだけです。</p>
<h3 id="%E6%BA%96%E5%82%99">準備 <a class="direct-link" href="#%E6%BA%96%E5%82%99">#</a></h3>
<p>まず Xamarin Studio で C# → コンソールアプリのプロジェクトを作ります。</p>
<p>次に、まず NTS を参照に追加しますが、Nuget という仕組みを使います。<br>
Xamarin Studio に Nuget を導入する手順は、</p>
<ul>
<li><a href="https://github.com/mrward/monodevelop-nuget-addin">mrward / monodevelop-nuget-addin</a></li>
</ul>
<p>を参考にしてください。</p>
<h3 id="%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F">コードを書く <a class="direct-link" href="#%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%8F">#</a></h3>
<p>こんな感じです。</p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">GeoAPI<span class="token punctuation">.</span>Geometries</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">NetTopologySuite</span><span class="token punctuation">;</span><br><br><span class="token keyword">namespace</span> <span class="token namespace">TopologyTest</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">class</span> <span class="token class-name">MainClass</span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> args<span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token class-name"><span class="token keyword">var</span></span> service <span class="token operator">=</span> NtsGeometryServices<span class="token punctuation">.</span>Instance<span class="token punctuation">;</span><br>            <span class="token class-name"><span class="token keyword">var</span></span> gf <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">CreateGeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>            <span class="token class-name"><span class="token keyword">var</span></span> polygonA <span class="token operator">=</span> gf<span class="token punctuation">.</span><span class="token function">CreatePolygon</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate<span class="token punctuation">[</span><span class="token punctuation">]</span></span><br>                <span class="token punctuation">{</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">34.0</span><span class="token punctuation">,</span> <span class="token number">136.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">34.0</span><span class="token punctuation">,</span> <span class="token number">138.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">37.0</span><span class="token punctuation">,</span> <span class="token number">138.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">37.0</span><span class="token punctuation">,</span> <span class="token number">136.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">34.0</span><span class="token punctuation">,</span> <span class="token number">136.0</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>            <span class="token class-name"><span class="token keyword">var</span></span> polygonB <span class="token operator">=</span> gf<span class="token punctuation">.</span><span class="token function">CreatePolygon</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate<span class="token punctuation">[</span><span class="token punctuation">]</span></span><br>                <span class="token punctuation">{</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">36.0</span><span class="token punctuation">,</span> <span class="token number">137.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">35.0</span><span class="token punctuation">,</span> <span class="token number">137.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">35.0</span><span class="token punctuation">,</span> <span class="token number">140.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>                    <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">36.0</span><span class="token punctuation">,</span> <span class="token number">137.0</span><span class="token punctuation">)</span><br>                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>            polygonA<span class="token punctuation">.</span><span class="token function">Intersection</span><span class="token punctuation">(</span>polygonB<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token string">"Intersection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            polygonA<span class="token punctuation">.</span><span class="token function">Union</span><span class="token punctuation">(</span>polygonB<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token string">"Union"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            polygonA<span class="token punctuation">.</span><span class="token function">SymmetricDifference</span><span class="token punctuation">(</span>polygonB<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token string">"SymmetricDifference"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            polygonA<span class="token punctuation">.</span><span class="token function">Difference</span><span class="token punctuation">(</span>polygonB<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token string">"Difference"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            polygonB<span class="token punctuation">.</span><span class="token function">Buffer</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token string">"Buffer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">GeomExtensions</span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ToConsole</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name">IGeometry</span> geom<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span></span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>tag <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> geom<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Intersection(AND)、Union(OR)、SymmeticDifference(XOR)、Difference(A - B)、Buffer(ふくらます)について試しています。</p>
<p>実行すると、コンソールに結果の座標群がずらーと出力されます。</p>
<h2 id="%E8%A6%8B%E3%81%88%E3%82%8B%E5%8C%96%E3%81%97%E3%81%A6%E3%82%88">見える化してよ <a class="direct-link" href="#%E8%A6%8B%E3%81%88%E3%82%8B%E5%8C%96%E3%81%97%E3%81%A6%E3%82%88">#</a></h2>
<p>プログラムによる視覚化は、、、ごめんなさい面倒だったので作りませんでした。</p>
<p>その代わり、GeoJSON 化して GitHub にアップして視覚化しました。</p>
<p>まず演算対象の <code>geometryA</code> と <code>geometryB</code> です。(外側の枠は気にしないでください)</p>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/01_polygonA.geojson">https://github.com/amay077/geojsontest/blob/master/01_polygonA.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/01_polygonA.geojson"></script>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/02_polygonB.geojson">https://github.com/amay077/geojsontest/blob/master/02_polygonB.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/02_polygonB.geojson"></script>
<h3 id="intersection(and)">Intersection(AND) <a class="direct-link" href="#intersection(and)">#</a></h3>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/03_polygonA_intersection_B.geojson">https://github.com/amay077/geojsontest/blob/master/03_polygonA_intersection_B.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/03_polygonA_intersection_B.geojson"></script>
<h3 id="union(or)">Union(OR) <a class="direct-link" href="#union(or)">#</a></h3>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/04_polygonA_union_B.geojson">https://github.com/amay077/geojsontest/blob/master/04_polygonA_union_B.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/04_polygonA_union_B.geojson"></script>
<h3 id="symmetricdifference(xor)">SymmetricDifference(XOR) <a class="direct-link" href="#symmetricdifference(xor)">#</a></h3>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/05_polygonA_symmetricdifference_B.geojson">https://github.com/amay077/geojsontest/blob/master/05_polygonA_symmetricdifference_B.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/05_polygonA_symmetricdifference_B.geojson"></script>
<h3 id="difference(a---b)">Difference(A - B) <a class="direct-link" href="#difference(a---b)">#</a></h3>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/06_polygonA_difference_B.geojson">https://github.com/amay077/geojsontest/blob/master/06_polygonA_difference_B.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/06_polygonA_difference_B.geojson"></script>
<h3 id="buffer(b%E3%82%92%E8%86%A8%E3%82%89%E3%81%BE%E3%81%99)">Buffer(Bを膨らます) <a class="direct-link" href="#buffer(b%E3%82%92%E8%86%A8%E3%82%89%E3%81%BE%E3%81%99)">#</a></h3>
<ul>
<li><a href="https://github.com/amay077/geojsontest/blob/master/07_geometryB_buffer.geojson">https://github.com/amay077/geojsontest/blob/master/07_geometryB_buffer.geojson</a></li>
</ul>
<script src="https://embed.github.com/view/geojson/amay077/geojsontest/master/07_geometryB_buffer.geojson"></script>
<p>いやー 便利ですね GitHub 。大量のマーカーは自動的にクラスター化までしてくれるそうですよ。</p>
<ul>
<li><a href="https://github.com/blog/1541-geojson-rendering-improvements">GeoJSON rendering improvements</a>。</li>
</ul>
<p>こちらは、 Leaflet.js、OpenStreetMap、<a href="https://www.mapbox.com/maki/">Maki Project</a> などの FOSS4G が使われています。いいですね。</p>
<p>さて、なんの話か分からなくなってきたので、こちらからは以上です。</p>


published at <time class="postlist-date" datetime="2013-12-16">16 Dec 2013</time>

tags: 

  <a href="/tags/Xamarin/" class="post-tag">Xamarin</a>
  <a href="/tags/XAC13/" class="post-tag">XAC13</a>
  <a href="/tags/iOS/" class="post-tag">iOS</a>
  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/C#/" class="post-tag">C#</a>
  <a href="/tags/Geo/" class="post-tag">Geo</a>
  <a href="/tags/FOSS4G/" class="post-tag">FOSS4G</a>

<hr>
<ul><li>Next: <a href="/blog/2013/12/18/report-of-oyako-robot-kyoshitsu/">家族ロボット教室に参加してきました</a></li><li>Previous: <a href="/blog/2013/12/14/using-azure-mobile-services-in-xamarin-1/">Xamarin で Windows Azure モバイルサービスを使う(その１)</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2013/12/16/guide-of-geomety-libraries-for-foss4g-dev/ -->
  </body>
</html>
