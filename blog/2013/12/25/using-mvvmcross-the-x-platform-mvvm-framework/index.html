<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>マルチプラットフォーム MVVMフレームワーク「MvvmCross」を使う</title>
    <meta name="description" content="Try and try again">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Experiments Never Fail">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Experiments Never Fail">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-224332-7"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-224332-7');
    </script>
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Experiments Never Fail</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <!-- Delete this message 
      <div class="warning">
        <ol>
          <li>Edit the <code>_data/metadata.json</code> with your blog’s information.</li>
          <li>(Optional) Edit <code>.eleventy.js</code> with your <a href="https://www.11ty.dev/docs/config/">configuration preferences</a>.</li>
          <li>Delete this message from <code>_includes/layouts/base.njk</code>.</li>
        </ol>
        <p><em>This is an <a href="https://www.11ty.dev/">Eleventy project</a> created from the <a href="https://github.com/11ty/eleventy-base-blog"><code>eleventy-base-blog</code> repo</a>.</em></p>
      </div>
      Stop deleting -->

      <h1>マルチプラットフォーム MVVMフレームワーク「MvvmCross」を使う</h1>

<p><a href="http://qiita.com/advent-calendar/2013/xamarin">Xamarin Advent Calendar 2013</a> も最終日となりました。<br>
最後は、「実用的な」マルチプラットフォーム開発のツールを紹介します。</p>
<!--more-->
<p>MvvmCross ってやつを紹介したいのですが、まずは事前知識からさらりと。</p>
<h2 id="mvvm-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">MVVM パターンについて <a class="direct-link" href="#mvvm-%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">#</a></h2>
<p>MVVM は、 Model-View-ViewModel の頭文字を取ったものです。<br>
MVC パターンの派生で、Microsoft が WPF/Silverlight のために作ったそうですが、今では JavaScript の <a href="http://knockoutjs.com/">Knockout.js</a> などでも利用されています。</p>
<p><img src="http://upload.wikimedia.org/wikipedia/commons/8/87/MVVMPattern.png" alt=""><br>
(via <a href="http://ja.wikipedia.org/wiki/Model_View_ViewModel">Model View ViewModel - WikiPedia</a> CC-BY 3.0)</p>
<ul>
<li>Model - MVC の Model と一緒。ビジネスロジックはここに。</li>
<li>View - WPF なら .xaml、iOS なら .storyboard、Android なら .xml それだけ。1行もコードを書かないのが理想。
<ul>
<li>DataBinding - ViewModel を監視して、ViewModel の情報を View に表示する。View でのユーザーからの入力を受け付けて ViewModel を変更したり、コマンドを実行する。</li>
</ul>
</li>
<li>ViewModel - View の為の Model。状態管理と View の為の情報＆機能公開、およびその為の Model の利用。”ロジック” はここにも書いちゃダメ。</li>
</ul>
<p>いやもう絶対他のリソース読んだ方が分かりやすいですから(逃げ)。</p>
<ul>
<li><a href="http://www.atmarkit.co.jp/fdotnet/chushin/greatblogentry_02/greatblogentry_02_01.html">MVVMパターンの常識 ― 「M」「V」「VM」の役割とは？ － ＠IT</a></li>
</ul>
<h2 id="pcl(portable-class-library)-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">PCL(Portable Class Library) について <a class="direct-link" href="#pcl(portable-class-library)-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">#</a></h2>
<p>WPF, Silverlight, Windows Store App など、異なるプラットフォームでバイナリを共有できる “ポータブルな” クラスライブラリ。</p>
<ul>
<li><a href="http://msdn.microsoft.com/ja-jp/library/windowsphone/develop/jj714086(v=vs.105).aspx">ポータブル クラス ライブラリを使用して機能を共有する</a></li>
</ul>
<p>そして、先日、Xamarin.Android と iOS でもポータルクラスライブラリが使える/作れるようになりました。</p>
<ul>
<li><a href="http://blog.xamarin.com/pcl-projects-and-vs2013/">PCL Projects and Visual Studio 2013 Support ｜ Xamarin Blog</a></li>
</ul>
<p>ポータブルクラスライブラリとして作られた DLL は、WPF でも Store App でも Android でも iOS でも使いまわせる、という事です。</p>
<h2 id="mvvmcross-%E3%81%A8%E3%81%AF">MvvmCross とは <a class="direct-link" href="#mvvmcross-%E3%81%A8%E3%81%AF">#</a></h2>
<p>さて本題。</p>
<p>MvvmCross は、様々なプラットフォームに対応した MVVMフレームワークです。対応プラットフォームをざっと挙げると、</p>
<ul>
<li>Xamarin.iOS</li>
<li>Xamarin.Android</li>
<li>Windows Phone</li>
<li>Windows Store App</li>
<li>WPF</li>
<li>Mac</li>
</ul>
<p>です。</p>
<p>MvvmCross を使うと、MVVM パターンでいうところの Model, ViewModel を複数のプラットフォームで共通にできます。</p>
<p>図にすると下のような感じです。</p>
<p><img src="/img/posts/using_mvvmcross_2_01.png" alt=""></p>
<p>「Model でプラットフォーム固有の機能使いたい場合もあるじゃん？」とかにも対応しているので、これが全てでは無いですが、最初の説明としてはこんなもんです。</p>
<p>ホームページなどはこちら。<br>
Evolve セッションの Slides の 1〜10ページ が分かりやすいですかね。</p>
<ul>
<li><a href="https://github.com/MvvmCross/MvvmCross">MvvmCross/MvvmCross - github</a></li>
<li><a href="http://xamarin.com/evolve/2013#session-dnoeeoarfj">Architecting Cross-Platform Apps with MvvmCross - Evolve 2013 Conference – Xamarin</a></li>
</ul>
<h2 id="xamarin.android-xamarin.ios-%E3%81%A7%E3%80%81mvvmcross-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">Xamarin.Android Xamarin.iOS で、MvvmCross を使ったアプリを作ってみる <a class="direct-link" href="#xamarin.android-xamarin.ios-%E3%81%A7%E3%80%81mvvmcross-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">#</a></h2>
<p>MvvmCross の現在 Stable なのは「v3」で、その Tutorials が</p>
<ul>
<li><a href="https://github.com/MvvmCross/MvvmCross/wiki/N-plus-1-Videos-Of-MvvmCross">N plus 1 Videos Of MvvmCross · MvvmCross/MvvmCross Wiki</a></li>
</ul>
<p>にあります。これがまたドットインストールも真っ青の充実ぶり。<br>
この動画を順番に見ながら写経すれば使えるようになっちゃいます。</p>
<p>という訳で、最初の１つ「N=0」をトレースしてみましょう。</p>
<h3 id="%E5%8B%95%E7%94%BB%E3%81%A8%E9%81%95%E3%81%86%E3%81%A8%E3%81%93%E3%82%8D">動画と違うところ <a class="direct-link" href="#%E5%8B%95%E7%94%BB%E3%81%A8%E9%81%95%E3%81%86%E3%81%A8%E3%81%93%E3%82%8D">#</a></h3>
<ul>
<li>Win でなく Mac、Visual Studio でなく Xamarin Studio を使います。Win+VS な人は動画をそのままトレースした方がよいでしょう。</li>
<li>Nuget 使いません。Nuget から取得したらエラーになったので、マニュアルでアセンブリ追加します。Nuget で配信されるプロジェクトのスケルトンも使わずスクラッチで実装します。</li>
<li>Windows Store App、Windows Phone は飛ばします。Mac なので。</li>
<li>iOS での UI 作成について。動画ではコードでUI構築してますが、Storyboard を使いました。その影響で、少しコードが動画と変わっています。</li>
</ul>
<p>では、開始〜。</p>
<h3 id="1.-pcl-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B">1. PCL プロジェクトを作る <a class="direct-link" href="#1.-pcl-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>Xamarin Studio にて、新しいソリューションと「Portable Library」プロジェクトを作ります。プロジェクト名は “FirstDemo.Core”、ソリューション名は “FirstDemo” とします。</p>
<p><img src="/img/posts/using_mvvmcross_2_02.png" alt=""></p>
<h3 id="2.-mvvmcross-%E3%81%AE%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B">2. MvvmCross のバイナリをダウンロードする <a class="direct-link" href="#2.-mvvmcross-%E3%81%AE%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B">#</a></h3>
<p><a href="https://github.com/mvvmcross/MvvmCross-Binaries/tree/v3.1">MvvmCross/MvvmCross-Binaries の v3.1 branch</a> をダウンロードなり Clone なりします。</p>
<h3 id="3.-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">3. プロジェクトにアセンブリ参照を追加する <a class="direct-link" href="#3.-%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">#</a></h3>
<p>FirstDemo.Core プロジェクトに、先ほどダウンロードした <code>MvvmCross-Binaries-3.1/VS2012/bin/Release/Mvx/Portable</code> の中の以下のファイルを参照追加します。</p>
<ul>
<li>Cirrious.CrossCore.dll</li>
<li>Cirrious.MvvmCross.dll</li>
<li>Cirrious.MvvmCross.Localization.dll</li>
</ul>
<p><img src="/img/posts/using_mvvmcross_2_03.png" alt=""></p>
<h3 id="4.-firstviewmodel-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81app-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">4. FirstViewModel クラス、App クラスの実装 <a class="direct-link" href="#4.-firstviewmodel-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81app-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">#</a></h3>
<p>Nuget でインストールされるはずのクラスを実装します。</p>
<p>まず、ViewModels というフォルダを作ってその中に <code>FirstViewModel</code> クラスを作ります。</p>
<p><strong>ViewModels/FirstViewModel.cs</strong></p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>ViewModels</span><span class="token punctuation">;</span><br><br><span class="token keyword">namespace</span> <span class="token namespace">FirstDemo<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>ViewModels</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MvxViewModel</span></span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _firstName<span class="token punctuation">;</span><br>        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FirstName<br>        <span class="token punctuation">{</span><br>            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _firstName<span class="token punctuation">;</span> <span class="token punctuation">}</span><br>            <span class="token keyword">set</span> <span class="token punctuation">{</span> _firstName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token function">RaisePropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> FullName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _lastName<span class="token punctuation">;</span><br>        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> LastName<br>        <span class="token punctuation">{</span><br>            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> _lastName<span class="token punctuation">;</span> <span class="token punctuation">}</span><br>            <span class="token keyword">set</span> <span class="token punctuation">{</span> _lastName <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token function">RaisePropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> FullName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> FullName<br>        <span class="token punctuation">{</span><br>            <span class="token keyword">get</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> String<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token string">"{0} {1}"</span><span class="token punctuation">,</span> _firstName<span class="token punctuation">,</span> _lastName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>次に <code>App</code> クラスはルートに。</p>
<p><strong>App.cs</strong></p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Cirrious<span class="token punctuation">.</span>CrossCore<span class="token punctuation">.</span>IoC</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">FirstDemo<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>ViewModels</span><span class="token punctuation">;</span><br><br><span class="token keyword">namespace</span> <span class="token namespace">FirstDemo<span class="token punctuation">.</span>Core</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>ViewModels<span class="token punctuation">.</span>MvxApplication</span></span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">public</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token function">CreatableTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">EndingWith</span><span class="token punctuation">(</span><span class="token string">"Service"</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">AsInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token punctuation">.</span><span class="token function">RegisterAsLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>            <span class="token generic-method"><span class="token function">RegisterAppStart</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>FirstViewModel<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p><code>MyClass.cs</code> は使わないので削除します。</p>
<p>ここまでが<a href="http://www.youtube.com/watch?v=_DHDMNB_IeY#t=281">動画の 4:40</a> くらいです。</p>
<h3 id="5.-android-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">5. Android の UI を作る <a class="direct-link" href="#5.-android-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>動画では <a href="http://www.youtube.com/watch?v=_DHDMNB_IeY#t=671">11:11</a> から。</p>
<p>ソリューションに Android Application プロジェクトを追加します。名前は “FirstDemo.Droid” とします。</p>
<p><img src="/img/posts/using_mvvmcross_2_04.png" alt=""></p>
<h3 id="6.-firstdemo.droid-%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">6. FirstDemo.Droid にアセンブリ参照を追加する <a class="direct-link" href="#6.-firstdemo.droid-%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">#</a></h3>
<p>まず、FirstDemo.Core をプロジェクト参照で追加します。<br>
次に、MvvmCross 関連のアセンブリ群、以下を追加します。動画では Nuget でやってるところです。</p>
<ul>
<li>Cirrious.CrossCore.dll</li>
<li>Cirrious.CrossCore.Droid.dll *</li>
<li>Cirrious.MvvmCross.dll</li>
<li>Cirrious.MvvmCross.Droid.dll *</li>
<li>Cirrious.MvvmCross.Binding.dll</li>
<li>Cirrious.MvvmCross.Binding.Droid.dll *</li>
<li>Cirrious.MvvmCross.Localization.dll</li>
</ul>
<p>「*」付きのアセンブリは <code>MvvmCross-Binaries-3.1/VS2012/bin/Release/Mvx/Droid/</code> から、付いてないアセンブリは Core と同じく <code>MvvmCross-Binaries-3.1/VS2012/bin/Release/Mvx/Portable/</code> から追加します。後ろに “Droid” と付いているものは、プラットフォーム用のフォルダから持ってきましょうという事ですね。</p>
<p><img src="/img/posts/using_mvvmcross_2_05.png" alt=""></p>
<h3 id="7.-firstview-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81setup-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">7. FirstView クラス、Setup クラスの実装 <a class="direct-link" href="#7.-firstview-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81setup-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">#</a></h3>
<p>こちらも Nuget が使えれば〜 のところ。</p>
<p><code>FirstView</code> は、MainView.cs をリファクタでリネーム＆ Views フォルダ移動して内容を下のように書き換えます。</p>
<p><strong>Views/FirstView.cs</strong></p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>App</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Content</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Runtime</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Views</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Widget</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>OS</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Droid<span class="token punctuation">.</span>Views</span><span class="token punctuation">;</span><br><br><span class="token keyword">namespace</span> <span class="token namespace">FirstDemo<span class="token punctuation">.</span>Droid<span class="token punctuation">.</span>Views</span><br><span class="token punctuation">{</span><br>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Activity</span><span class="token attribute-arguments"><span class="token punctuation">(</span>Label <span class="token operator">=</span> <span class="token string">"FirstDemo.Droid"</span><span class="token punctuation">,</span> MainLauncher <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> Icon <span class="token operator">=</span> <span class="token string">"@drawable/icon"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span><br>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FirstView</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MvxActivity</span></span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> bundle<span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnCreate</span><span class="token punctuation">(</span>bundle<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            <span class="token function">SetContentView</span><span class="token punctuation">(</span>Resource<span class="token punctuation">.</span>Layout<span class="token punctuation">.</span>Main<span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>Setup.cs はルートに作ります。</p>
<p><strong>Setup.cs</strong></p>
<pre class="language-csharp"><code class="language-csharp"><span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Droid<span class="token punctuation">.</span>Platform</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Android<span class="token punctuation">.</span>Content</span><span class="token punctuation">;</span><br><span class="token keyword">using</span> <span class="token namespace">Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>ViewModels</span><span class="token punctuation">;</span><br><br><span class="token keyword">namespace</span> <span class="token namespace">FirstDemo<span class="token punctuation">.</span>Droid</span><br><span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Setup</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">MvxAndroidSetup</span></span><br>    <span class="token punctuation">{</span><br>        <span class="token keyword">public</span> <span class="token function">Setup</span><span class="token punctuation">(</span><span class="token class-name">Context</span> appContext<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>appContext<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><br><br>        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">IMvxApplication</span> <span class="token function">CreateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Core<span class="token punctuation">.</span>App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>あ、 <code>SplashScreen</code> は省略します。説明が面倒なので。</p>
<h3 id="8.-databinding-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B">8.  DataBinding の定義ファイルを作る <a class="direct-link" href="#8.-databinding-%E3%81%AE%E5%AE%9A%E7%BE%A9%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>これも Nuget の代わりにやるところ。<br>
データバインディングを行うために必要なファイルです。この手順を忘れて、ビルドエラーでしばらくハマってました。</p>
<p><code>Resource/values</code> フォルダ内に以下の xml ファイルを作成します。</p>
<p><strong>Resources/values/MvxBindingAttributes.xml</strong></p>
<pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxBinding<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxBind<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxLang<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxControl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxListView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxItemTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxDropDownItemTemplate<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxBindingTagUnique<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxImageView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MvxSource<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span></code></pre>
<h3 id="9.-%E7%94%BB%E9%9D%A2%E3%82%92%E4%BD%9C%E3%82%8B">9. 画面を作る <a class="direct-link" href="#9.-%E7%94%BB%E9%9D%A2%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>画面のレイアウトを作ります。<br>
Xamarin Studio の Android用 UI デザイナは強力なので、ここだけは Visual Studio に勝っていると言えます。</p>
<p><code>Main.axml</code> を開いて、レイアウトされているボタンを削除し、「Plain Text」を2つと、Text(Mid) を1つ、縦に並べて配置します。</p>
<p><img src="/img/posts/using_mvvmcross_2_06.png" alt=""></p>
<h3 id="10.-%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B">10. データバインディングを記述する <a class="direct-link" href="#10.-%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B">#</a></h3>
<p><code>Main.axml</code> の「ソース」を開いて、データバインディングについての記述をします。完成形は下のようになります。</p>
<p><strong>Resources/layout/Main.xml</strong></p>
<pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">xmlns:</span>local</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>vertical<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fill_parent<span class="token punctuation">"</span></span><br>    <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fill_parent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">local:</span>MvxBind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Text FirstName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>EditText</span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">local:</span>MvxBind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Text LastName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span><br>        <span class="token attr-name"><span class="token namespace">android:</span>text</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Medium Text<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>textAppearance</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>?android:attr/textAppearanceMedium<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span><br>        <span class="token attr-name"><span class="token namespace">local:</span>MvxBind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Text FullName<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">></span></span></code></pre>
<p>これで Android UI の実装は終わり。動画では <a href="http://www.youtube.com/watch?v=_DHDMNB_IeY#t=980">16:20</a> あたり。<br>
Android 側では、初期化を除けば <strong>何も実装してない</strong> のがミソ。</p>
<h3 id="11.-android-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">11. Android アプリを動かしてみる <a class="direct-link" href="#11.-android-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">#</a></h3>
<p>エミュレータで実行してみると、こんな感じです。</p>
<p><img src="/img/posts/using_mvvmcross_2_07.gif" alt=""></p>
<p>Steve を痛恨のスペルミスしたけど、まあいいや。</p>
<p>では続いて、iOS アプリの実装です。</p>
<h3 id="12.-ios-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">12. iOS の UI を作る <a class="direct-link" href="#12.-ios-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>動画では <a href="http://www.youtube.com/watch?v=_DHDMNB_IeY#t=1558">25:58</a> から。</p>
<p>ソリューションに iPhone Application プロジェクトを追加します。Storyboard を使ってみましょう。名前は “FirstDemo.Touch” とします。(iOS 版の接尾辞に ”Touch” を使うのは、Xamarin.iOS の以前の名称である ”MonoTouch” からだと思いますが、大文字で始まる .NET 文化の中では “iOS” はとかく都合が悪いので、Touch という接尾辞は私も気に入っています。)</p>
<p><img src="/img/posts/using_mvvmcross_2_08.png" alt=""></p>
<h3 id="13.-firstdemo.touch-%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">13. FirstDemo.Touch にアセンブリ参照を追加する <a class="direct-link" href="#13.-firstdemo.touch-%E3%81%AB%E3%82%A2%E3%82%BB%E3%83%B3%E3%83%96%E3%83%AA%E5%8F%82%E7%85%A7%E3%82%92%E8%BF%BD%E5%8A%A0%E3%81%99%E3%82%8B">#</a></h3>
<p>Android の場合と同様、FirstDemo.Core をプロジェクト参照で追加します。<br>
次に、MvvmCross 関連のアセンブリ群、以下を追加します。</p>
<ul>
<li>Cirrious.CrossCore.dll</li>
<li>Cirrious.CrossCore.Touch.dll *</li>
<li>Cirrious.MvvmCross.dll</li>
<li>Cirrious.MvvmCross.Touch.dll *</li>
<li>Cirrious.MvvmCross.Binding.dll</li>
<li>Cirrious.MvvmCross.Binding.Touch.dll *</li>
<li>Cirrious.MvvmCross.Localization.dll</li>
</ul>
<p>「*」付きのアセンブリは MvvmCross-Binaries-3.1/VS2012/bin/Release/Mvx/Touch/ から、付いてないアセンブリは Core と同じく MvvmCross-Binaries-3.1/VS2012/bin/Release/Mvx/Portable/ から追加します。後ろに “Touch” と付いているものは、プラットフォーム用のフォルダから持ってきましょうという事ですね。</p>
<p><img src="/img/posts/using_mvvmcross_2_09.png" alt=""></p>
<h3 id="14.-setup-%E3%82%AF%E3%83%A9%E3%82%B9%2C-appdelegate-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81firstview-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">14. Setup クラス, AppDelegate クラス、FirstView クラスの実装 <a class="direct-link" href="#14.-setup-%E3%82%AF%E3%83%A9%E3%82%B9%2C-appdelegate-%E3%82%AF%E3%83%A9%E3%82%B9%E3%80%81firstview-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E5%AE%9F%E8%A3%85">#</a></h3>
<p>とここまで書いておいて、MvvmCross は実は Storyboard で使う時は少し細工が必要な事に気づいた。。。</p>
<p>MvvmCross の作者である slodge さんが下で回答されています。</p>
<ul>
<li><a href="http://stackoverflow.com/a/16323115">monotouch - MvvmCross and Xcode Storyboard - Stack Overflow</a></li>
</ul>
<p>という訳でここからのコードは、上記で示されている ‘eh’ もミックスしたもので、動画とは少し異なります。動作は同じです。</p>
<p>まず、Setup.cs をルートに作成して以下のように実装します。</p>
<p><strong>Setup.cs</strong></p>
<pre class="language-objc"><code class="language-objc">using System<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Touch<span class="token punctuation">.</span>Platform<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Touch<span class="token punctuation">.</span>Views<span class="token punctuation">.</span>Presenters<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>ViewModels<span class="token punctuation">;</span><br><br>namespace FirstDemo<span class="token punctuation">.</span>Touch<br><span class="token punctuation">{</span><br>    public class Setup <span class="token punctuation">:</span> MvxTouchSetup<br>    <span class="token punctuation">{</span><br>        public <span class="token function">Setup</span><span class="token punctuation">(</span>MvxApplicationDelegate appDelegate<span class="token punctuation">,</span> IMvxTouchViewPresenter presenter<span class="token punctuation">)</span><br>            <span class="token punctuation">:</span> <span class="token function">base</span><span class="token punctuation">(</span>appDelegate<span class="token punctuation">,</span> presenter<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><br><br>        protected override IMvxApplication <span class="token function">CreateApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> new Core<span class="token punctuation">.</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>既存の AppDelegate.cs を以下のように書き換えます。</p>
<p><strong>AppDelegate.cs</strong></p>
<pre class="language-objc"><code class="language-objc">using MonoTouch<span class="token punctuation">.</span>Foundation<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Touch<span class="token punctuation">.</span>Platform<span class="token punctuation">;</span><br>using MonoTouch<span class="token punctuation">.</span>UIKit<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Touch<span class="token punctuation">.</span>Views<span class="token punctuation">.</span>Presenters<span class="token punctuation">;</span><br><br>namespace FirstDemo<span class="token punctuation">.</span>Touch<br><span class="token punctuation">{</span><br>    <span class="token punctuation">[</span><span class="token function">Register</span><span class="token punctuation">(</span><span class="token string">"AppDelegate"</span><span class="token punctuation">)</span><span class="token punctuation">]</span><br>    public partial class AppDelegate <span class="token punctuation">:</span> MvxApplicationDelegate<br>    <span class="token punctuation">{</span><br>        public override UIWindow Window <span class="token punctuation">{</span> get<span class="token punctuation">;</span> set<span class="token punctuation">;</span> <span class="token punctuation">}</span><br><br>        public override <span class="token keyword">void</span> <span class="token function">FinishedLaunching</span><span class="token punctuation">(</span>UIApplication application<span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            var setup <span class="token operator">=</span> new <span class="token function">Setup</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> new <span class="token function">MvxTouchViewPresenter</span><span class="token punctuation">(</span>this<span class="token punctuation">,</span> Window<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            setup<span class="token punctuation">.</span><span class="token function">Initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>FirstView.cs は、FirstDemo.FirstDemoViewController.cs をリネームして作成します。Views フォルダを作って移動もしましょう。<br>
また、<code>MvxViewConroller</code> から派生させるように変更します。</p>
<p><img src="/img/posts/using_mvvmcross_2_10.png" alt=""></p>
<h3 id="15.-ios-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">15. iOS の UI を作る <a class="direct-link" href="#15.-ios-%E3%81%AE-ui-%E3%82%92%E4%BD%9C%E3%82%8B">#</a></h3>
<p>iOS 版の画面をレイアウトします。<br>
動画ではコードで <code>UITextField</code> などを配置していますが、 <strong>UI をコードで記述する事は万死に値する</strong> ので、Xamarin Studio の iOS デザイナもしくは Xcode の Interface Builder を使います。</p>
<p>下の図は、Xamarin Studio α版の iOS デザイナ を使った例です。<a href="http://qiita.com/amay077/items/716742474bce343c5729">以前に紹介した</a>ものです。</p>
<p><img src="/img/posts/using_mvvmcross_2_11.png" alt=""></p>
<p>TextField 2つと、Label を、<code>textEditFirst</code>, <code>textEditLast</code>, <code>labelFull</code> という変数にしておきます。</p>
<h3 id="16.-%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B">16. データバインディングを記述する <a class="direct-link" href="#16.-%E3%83%87%E3%83%BC%E3%82%BF%E3%83%90%E3%82%A4%E3%83%B3%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%82%92%E8%A8%98%E8%BF%B0%E3%81%99%E3%82%8B">#</a></h3>
<p>MvvmCross を iOS で使う場合、残念ながら storyboard 側にバインディングを記述する事はできないので、<code>FirstView.cs</code>  にコードで記述します。</p>
<p><code>ViewDidLoad</code> に以下のように追記します。</p>
<p><strong>Views/FirstView.cs</strong></p>
<pre class="language-objc"><code class="language-objc">using System<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Binding<span class="token punctuation">.</span>BindingContext<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>Touch<span class="token punctuation">.</span>Views<span class="token punctuation">;</span><br>using Cirrious<span class="token punctuation">.</span>MvvmCross<span class="token punctuation">.</span>ViewModels<span class="token punctuation">;</span><br>using FirstDemo<span class="token punctuation">.</span>Core<span class="token punctuation">.</span>ViewModels<span class="token punctuation">;</span><br><br>namespace FirstDemo<span class="token punctuation">.</span>Touch<br><span class="token punctuation">{</span><br>    public partial class FirstView <span class="token punctuation">:</span> MvxViewController<br>    <span class="token punctuation">{</span><br>        <span class="token comment">/* 省略 */</span><br><br>        public override <span class="token keyword">void</span> <span class="token function">ViewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">{</span><br>            this<span class="token punctuation">.</span>Request <span class="token operator">=</span> new MvxViewModelRequest<span class="token operator">&lt;</span>FirstViewModel<span class="token operator">></span><span class="token punctuation">(</span><br>                null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> new <span class="token function">MvxRequestedBy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <br>            base<span class="token punctuation">.</span><span class="token function">ViewDidLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>            var set <span class="token operator">=</span> this<span class="token punctuation">.</span>CreateBindingSet<span class="token operator">&lt;</span>FirstView<span class="token punctuation">,</span> FirstViewModel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>            set<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>textEditFirst<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">To</span><span class="token punctuation">(</span>vm <span class="token operator">=</span><span class="token operator">></span> vm<span class="token punctuation">.</span>FirstName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            set<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>textEditLast<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">To</span><span class="token punctuation">(</span>vm <span class="token operator">=</span><span class="token operator">></span> vm<span class="token punctuation">.</span>LastName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            set<span class="token punctuation">.</span><span class="token function">Bind</span><span class="token punctuation">(</span>labelFull<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">To</span><span class="token punctuation">(</span>vm <span class="token operator">=</span><span class="token operator">></span> vm<span class="token punctuation">.</span>FullName<span class="token punctuation">)</span><span class="token punctuation">;</span><br>            set<span class="token punctuation">.</span><span class="token function">Apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>        <span class="token punctuation">}</span><br><br>        <span class="token comment">/* 省略 */</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>これで iOS 側も実装終了、動画では <a href="http://www.youtube.com/watch?v=_DHDMNB_IeY#t=2020">33:40</a> まで来ました。</p>
<h3 id="17.-ios-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">17. iOS アプリを動かしてみる <a class="direct-link" href="#17.-ios-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%92%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">#</a></h3>
<p>動画では、Windows であるため Mac にリモート接続して実行していますが、Mac+Xamarin Studio なら即実行できます。</p>
<p><img src="/img/posts/using_mvvmcross_2_12.gif" alt=""></p>
<h2 id="mvvmcross-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81">MvvmCross についてのまとめ <a class="direct-link" href="#mvvmcross-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p>今日の完成版のコードは</p>
<ul>
<li><a href="https://github.com/amay077/NPlus1DaysOfMvvmCrossWithXamarinStudio/tree/master/N-00-FirstDemo">NPlus1DaysOfMvvmCrossWithXamarinStudio / N-00-FirstDemo - github</a></li>
</ul>
<p>に置いておきました。</p>
<p>ちょっと STEP が多くなっちゃいましたが、MvvmCross を使うと、複数のプラットフォームで ViewModel-Model を共通化できることが分かったと思います。</p>
<p><a href="https://github.com/MvvmCross/MvvmCross/wiki/N-plus-1-Videos-Of-MvvmCross">N+1 Days-</a> は、現在 39(!!) まであります。動画観てるだけでもわかった感じになります。（私は N=8 まで観た気がします。）</p>
<p>また、 @MvvmCross にツイートすると、気さくに（英語ですが）回答してくれます。</p>
<p>使いこなせば強力な武器になる MvvmCross 、今後も要チェックです。</p>
<h2 id="xamarin-advent-calendar-2013-%E3%81%BE%E3%81%A8%E3%82%81">Xamarin Advent Calendar 2013 まとめ <a class="direct-link" href="#xamarin-advent-calendar-2013-%E3%81%BE%E3%81%A8%E3%82%81">#</a></h2>
<p>勢いに任せて作った XAC2013、なんとか完走できました。<br>
「全部俺」でもいいやと思っていましたが、私含め5名の方に参加して頂けました、ありがとうございました。</p>
<p><a href="http://www.amazon.co.jp/gp/product/B00H2SBO4E?ie=UTF8&amp;camp=1207&amp;creative=8411&amp;creativeASIN=B00H2SBO4E&amp;linkCode=shr&amp;tag=oku2008-22&amp;=books&amp;qid=1387973043&amp;sr=1-1&amp;keywords=%E6%97%A5%E7%B5%8C%E3%82%BD%E3%83%95%E3%83%88%E3%82%A6%E3%82%A8%E3%82%A2+2014%E5%B9%B42%E6%9C%88%E5%8F%B7">日経ソフトウェア</a> によると、「2014年にブレークする技術」に Xamarin はありませんでしたが、MS と提携以後のプッシュぶりを見ていると、今後、来年のブレークに期待できそうです。</p>
<p>昨日の @atsushieno さんの <a href="http://atsushieno.hatenablog.com/entry/2013/12/24/213950">Xamarin 創立からの苦労話</a> を知ると、安易に「ライセンス高ぇ！値下げPlz！」などとは言えませんが、ユーザ(デベロッパ)を増やしたいのもまた事実。α/β版だけでも 30days のトライアル期限なくしてもらえたいら嬉しいですね。</p>
<p>Xamarin Advent Calendar 2013 はこれで終わりですが、今後もちまちまと Tips みたいなものを書いてくつもりですので、 <a href="http://qiita.com/tags/xamarin">Qiita のタグ</a> をチェックしてもらえると嬉しいです。</p>
<p>そして Xamarin Advent Calendar 2014 でまたお会いしましょう。</p>


published at <time class="postlist-date" datetime="2013-12-25">25 Dec 2013</time>

tags: 

  <a href="/tags/Xamarin/" class="post-tag">Xamarin</a>
  <a href="/tags/XAC13/" class="post-tag">XAC13</a>
  <a href="/tags/iOS/" class="post-tag">iOS</a>
  <a href="/tags/Android/" class="post-tag">Android</a>
  <a href="/tags/C#/" class="post-tag">C#</a>

<hr>
<ul><li>Next: <a href="/blog/2014/01/02/nhk-kouhaku-utagassen-apps-made-by-xamarin/">NHK紅白の Android/iPhone アプリが .NET/Xamarin 製だったということ</a></li><li>Previous: <a href="/blog/2013/12/23/using-yahoo-maps-sdk-for-ios-in-xamarin-ios/">Xamarin.iOS で Yahoo! iOSマップSDK を使ってみる</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /blog/2013/12/25/using-mvvmcross-the-x-platform-mvvm-framework/ -->
  </body>
</html>
